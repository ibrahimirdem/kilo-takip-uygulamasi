<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilo Takip Uygulamasƒ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#6366f1',
                        accent: '#818cf8',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        dark: '#1e293b',
                        light: '#f8fafc',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .chart-container { position: relative; height: 300px; }
        .measurement-tooltip {
            position: fixed;
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: none;
            pointer-events: none;
        }
        .measurement-tooltip.active {
            display: block;
        }
        .measurement-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #1e293b;
        }
        .info-icon {
            cursor: pointer;
            transition: all 0.2s;
        }
        .info-icon:hover {
            transform: scale(1.1);
            color: #4f46e5;
        }
        /* Chain Visualization Styles */
        .chain-day {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .chain-day:hover {
            transform: scale(1.1);
        }
        .chain-day.completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(16, 185, 129, 0.3);
        }
        .chain-day.missed {
            background: #fecaca;
            color: #dc2626;
        }
        .chain-day.today {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .chain-day.future {
            background: #f3f4f6;
            color: #9ca3af;
        }
        .chain-day.today-completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse-green 2s infinite;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        .chain-day.streak-fire::after {
            content: 'üî•';
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 14px;
        }
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            50% { box-shadow: 0 0 0 6px rgba(245, 158, 11, 0); }
        }
        @keyframes pulse-green {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 6px rgba(16, 185, 129, 0); }
        }
        .goal-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .goal-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .streak-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .motivation-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 p-2 rounded-full">
                        <i class="fas fa-weight text-xl"></i>
                    </div>
                    <h1 class="text-xl md:text-2xl font-bold">Kilo Takip</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-2">
                    <button id="weightSectionBtn" class="section-nav-btn bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all text-sm font-medium">
                        <i class="fas fa-weight mr-2"></i>Kilo
                    </button>
                    <button id="measurementsSectionBtn" class="section-nav-btn hover:bg-white/20 px-4 py-2 rounded-lg transition-all text-sm font-medium">
                        <i class="fas fa-ruler mr-2"></i>√ñl√ß√ºler
                    </button>
                    <button id="goalsSectionBtn" class="section-nav-btn hover:bg-white/20 px-4 py-2 rounded-lg transition-all text-sm font-medium">
                        <i class="fas fa-link mr-2"></i>Hedefler
                    </button>
                </nav>
                <div class="flex items-center space-x-2">
                    <button id="userSettingsBtn" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-all">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Section Navigation -->
    <div id="mobileSectionNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2">
        <div class="grid grid-cols-3 gap-2">
            <button id="mobileWeightSectionBtn" class="mobile-section-nav-btn bg-primary/10 text-primary flex items-center justify-center p-3 rounded-lg font-medium transition-all">
                <i class="fas fa-weight mr-2"></i>
                <span class="text-sm">Kilo</span>
            </button>
            <button id="mobileMeasurementsSectionBtn" class="mobile-section-nav-btn text-gray-500 hover:text-primary hover:bg-primary/5 flex items-center justify-center p-3 rounded-lg font-medium transition-all">
                <i class="fas fa-ruler mr-2"></i>
                <span class="text-sm">√ñl√ß√ºler</span>
            </button>
            <button id="mobileGoalsSectionBtn" class="mobile-section-nav-btn text-gray-500 hover:text-primary hover:bg-primary/5 flex items-center justify-center p-3 rounded-lg font-medium transition-all">
                <i class="fas fa-link mr-2"></i>
                <span class="text-sm">Hedefler</span>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation for Weight -->
    <div id="mobileNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2">
        <div class="grid grid-cols-4 gap-1">
            <button onclick="openTab(event, 'weightTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-plus-circle text-xl mb-1"></i>
                <span class="text-xs">Ekle</span>
            </button>
            <button onclick="openTab(event, 'historyTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-history text-xl mb-1"></i>
                <span class="text-xs">Ge√ßmi≈ü</span>
            </button>
            <button onclick="openTab(event, 'targetsTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-bullseye text-xl mb-1"></i>
                <span class="text-xs">Hedefler</span>
            </button>
            <button onclick="openTab(event, 'chartTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-chart-line text-xl mb-1"></i>
                <span class="text-xs">Grafik</span>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation for Measurements -->
    <div id="mobileMeasurementNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2 hidden">
        <div class="grid grid-cols-3 gap-1">
            <button onclick="openMeasurementTab(event, 'measurementEntryTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-plus-circle text-xl mb-1"></i>
                <span class="text-xs">Ekle</span>
            </button>
            <button onclick="openMeasurementTab(event, 'measurementHistoryTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-history text-xl mb-1"></i>
                <span class="text-xs">Ge√ßmi≈ü</span>
            </button>
            <button onclick="openMeasurementTab(event, 'measurementChartTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-chart-line text-xl mb-1"></i>
                <span class="text-xs">Grafik</span>
            </button>
        </div>
    </div>

    <!-- User Settings Modal -->
    <div id="userSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 hidden overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-medium w-full max-w-md mx-4 p-6 transform transition-all my-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-dark">Kullanƒ±cƒ± Ayarlarƒ±</h2>
                <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-2">Kullanƒ±cƒ± Bilgileri</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm text-gray-600 mb-1">Kullanƒ±cƒ± ID</p>
                    <p id="userDisplay" class="font-mono text-sm text-dark break-all"></p>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-3">Ki≈üisel Bilgiler</h3>
                <p class="text-gray-600 text-sm mb-4">V√ºcut yaƒü oranƒ± hesaplamasƒ± i√ßin boy ve cinsiyet bilgilerinizi girin.</p>
                <form id="profileForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Boy (cm)</label>
                        <input type="number" id="userHeight" step="0.1" min="0" placeholder="√ñrn: 175" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cinsiyet</label>
                        <select id="userGender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Se√ßiniz</option>
                            <option value="male">Erkek</option>
                            <option value="female">Kadƒ±n</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-3">Veri Y√∂netimi</h3>
                <p class="text-gray-600 text-sm mb-4">Verileriniz tarayƒ±cƒ±nƒ±zda saklanƒ±r. Farklƒ± cihazlarda kullanmak i√ßin verilerinizi dƒ±≈üa aktarabilirsiniz.</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="exportData" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all">
                        <i class="fas fa-download mr-2"></i> Dƒ±≈üa Aktar
                    </button>
                    <button id="importData" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-primary transition-all">
                        <i class="fas fa-upload mr-2"></i> ƒ∞√ße Aktar
                    </button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
            
            <div class="border-t pt-4">
                <button id="clearAllData" class="w-full bg-danger text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
                    <i class="fas fa-trash-alt mr-2"></i> T√ºm Verileri Sil
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Weight Tracking Section -->
        <div id="weightSection" class="section-content">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Mevcut Kilo</p>
                        <p id="currentWeight" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-primary/10 p-3 rounded-full">
                        <i class="fas fa-weight text-primary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Ba≈ülangƒ±√ß Kilo</p>
                        <p id="startingWeight" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-secondary/10 p-3 rounded-full">
                        <i class="fas fa-flag text-secondary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Toplam Deƒüi≈üim</p>
                        <p id="totalChange" class="text-3xl font-bold mt-1">--</p>
                    </div>
                    <div class="bg-warning/10 p-3 rounded-full">
                        <i class="fas fa-chart-line text-warning text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Tabs -->
        <div class="hidden md:flex bg-white rounded-xl shadow-soft p-1 mb-6">
            <button onclick="openTab(event, 'weightTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-plus-circle mr-2"></i> Kilo Giri≈üi
            </button>
            <button onclick="openTab(event, 'historyTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-history mr-2"></i> Ge√ßmi≈ü
            </button>
            <button onclick="openTab(event, 'targetsTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-bullseye mr-2"></i> Hedefler
            </button>
            <button onclick="openTab(event, 'chartTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-chart-line mr-2"></i> Grafikler
            </button>
        </div>

        <!-- Tab Contents -->
        <div id="weightTab" class="tab-content">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-primary mr-3"></i>
                    Yeni Kilo Giri≈üi
                </h2>
                <form id="weightForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tarih</label>
                            <div class="relative">
                                <input type="date" id="date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Saat</label>
                            <div class="relative">
                                <input type="time" id="time" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-clock absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kilo (kg)</label>
                        <div class="relative">
                            <input type="number" id="weight" step="0.1" min="0" placeholder="√ñrn: 75.5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                            <i class="fas fa-weight absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Not (ƒ∞steƒüe Baƒülƒ±)</label>
                        <div class="relative">
                            <input type="text" id="note" placeholder="√ñrn: Sabah a√ß karnƒ±na" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
        </div>

        <div id="historyTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-history text-primary mr-3"></i>
                        Kilo Ge√ßmi≈üi
                    </h2>
                    <button id="clearHistory" class="text-danger hover:bg-danger/10 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-trash-alt mr-2"></i> T√ºm√ºn√º Sil
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kilo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Deƒüi≈üim</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Not</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ƒ∞≈ülem</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="bg-white divide-y divide-gray-100">
                            <!-- Veriler JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                    <div id="emptyHistory" class="text-center py-12">
                        <i class="fas fa-weight-scale text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Hen√ºz hi√ß kilo kaydƒ± yok.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="targetsTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-bullseye text-primary mr-3"></i>
                    Yeni Hedef Ekle
                </h2>
                <form id="targetForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Tarihi</label>
                            <div class="relative">
                                <input type="date" id="targetDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Kilo (kg)</label>
                            <div class="relative">
                                <input type="number" id="targetWeight" step="0.1" min="0" placeholder="√ñrn: 70.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <i class="fas fa-weight absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Boyun (cm)</label>
                            <div class="relative">
                                <input type="number" id="targetNeck" step="0.1" min="0" placeholder="√ñrn: 35.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <i class="fas fa-ruler absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Bel (cm)</label>
                            <div class="relative">
                                <input type="number" id="targetWaist" step="0.1" min="0" placeholder="√ñrn: 80.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <i class="fas fa-ruler-horizontal absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Kal√ßa (cm)</label>
                            <div class="relative">
                                <input type="number" id="targetHip" step="0.1" min="0" placeholder="√ñrn: 95.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                <i class="fas fa-ruler-combined absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">A√ßƒ±klama</label>
                        <div class="relative">
                            <input type="text" id="targetDescription" placeholder="√ñrn: Yaz tatiline kadar" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-plus mr-2"></i> Hedef Ekle
                    </button>
                </form>
            </div>

            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-bullseye text-primary mr-3"></i>
                        Hedeflerim
                    </h2>
                </div>
                <div id="targetsList" class="divide-y divide-gray-100">
                    <!-- Hedefler JavaScript ile doldurulacak -->
                    <div id="emptyTargets" class="text-center py-12">
                        <i class="fas fa-bullseye text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Hen√ºz hi√ß hedef belirlemediniz.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="chartTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-chart-line text-primary mr-3"></i>
                    Kilo Deƒüi≈üim Grafiƒüi
                </h2>
                <div class="chart-container">
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
        </div>
        </div>
        <!-- End Weight Tracking Section -->

        <!-- Body Measurements Section -->
        <div id="measurementsSection" class="section-content hidden">
        <!-- Measurements Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Boyun √ñl√ß√ºs√º</p>
                        <div class="flex items-baseline gap-2">
                            <p id="currentNeck" class="text-3xl font-bold text-dark mt-1">--</p>
                            <span id="neckDiff" class="text-xs font-medium"></span>
                        </div>
                    </div>
                    <div class="bg-primary/10 p-3 rounded-full">
                        <i class="fas fa-ruler text-primary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Bel √ñl√ß√ºs√º</p>
                        <div class="flex items-baseline gap-2">
                            <p id="currentWaist" class="text-3xl font-bold text-dark mt-1">--</p>
                            <span id="waistDiff" class="text-xs font-medium"></span>
                        </div>
                    </div>
                    <div class="bg-secondary/10 p-3 rounded-full">
                        <i class="fas fa-ruler-horizontal text-secondary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Kal√ßa √ñl√ß√ºs√º</p>
                        <div class="flex items-baseline gap-2">
                            <p id="currentHip" class="text-3xl font-bold text-dark mt-1">--</p>
                            <span id="hipDiff" class="text-xs font-medium"></span>
                        </div>
                    </div>
                    <div class="bg-warning/10 p-3 rounded-full">
                        <i class="fas fa-ruler-combined text-warning text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">V√ºcut Yaƒü Oranƒ±</p>
                        <p id="currentBodyFat" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-success/10 p-3 rounded-full">
                        <i class="fas fa-percentage text-success text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Tabs -->
        <div class="hidden md:flex bg-white rounded-xl shadow-soft p-1 mb-6">
            <button onclick="openMeasurementTab(event, 'measurementEntryTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-plus-circle mr-2"></i> √ñl√ß√º Giri≈üi
            </button>
            <button onclick="openMeasurementTab(event, 'measurementHistoryTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-history mr-2"></i> Ge√ßmi≈ü
            </button>
            <button onclick="openMeasurementTab(event, 'measurementChartTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-chart-line mr-2"></i> Grafikler
            </button>
        </div>

        <!-- Tab Contents -->
        <div id="measurementEntryTab" class="measurement-tab-content">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-primary mr-3"></i>
                    Yeni V√ºcut √ñl√ß√ºs√º Giri≈üi
                </h2>
                <form id="measurementForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tarih</label>
                            <div class="relative">
                                <input type="date" id="measurementDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Saat</label>
                            <div class="relative">
                                <input type="time" id="measurementTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-clock absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Boyun (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="neck-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="neck-tooltip">
                                    Kar≈üƒ±daki bir noktaya bakar pozisyonunda boynunuzu dik tutun. Gƒ±rtlak √ßƒ±kƒ±ntƒ±sƒ±nƒ±n (adem elmasƒ±) alt sƒ±nƒ±rƒ±ndaki noktadan mezuranƒ±z ile boyun √ßevresini √∂l√ßebilirsiniz.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="neck" step="0.1" min="0" placeholder="√ñrn: 35.5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Bel (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="waist-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="waist-tooltip">
                                    Ayakta dik pozisyonda, kollarƒ±nƒ±z yanƒ±nƒ±zda gev≈üek ≈üekilde dururken g√∂beƒüinizin en geni≈ü yerinden (genellikle g√∂bek hizasƒ±ndan) mezuranƒ±zƒ± gev≈üek tutarak bel √ßevrenizi √∂l√ß√ºn. Mezura yere paralel olmalƒ±dƒ±r.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="waist" step="0.1" min="0" placeholder="√ñrn: 80.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler-horizontal absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Kal√ßa (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="hip-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="hip-tooltip">
                                    Ayakta dik pozisyonda, ayaklarƒ±nƒ±z biti≈üik ≈üekilde dururken kal√ßanƒ±zƒ±n en geni≈ü noktasƒ±ndan (genellikle kal√ßa kemiklerinin en √ßƒ±kƒ±ntƒ±lƒ± olduƒüu yerden) mezuranƒ±zƒ± gev≈üek tutarak kal√ßa √ßevrenizi √∂l√ß√ºn.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="hip" step="0.1" min="0" placeholder="√ñrn: 95.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler-combined absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Not (ƒ∞steƒüe Baƒülƒ±)</label>
                        <div class="relative">
                            <input type="text" id="measurementNote" placeholder="√ñrn: Sabah √∂l√ß√ºm√º" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
        </div>

        <div id="measurementHistoryTab" class="measurement-tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-history text-primary mr-3"></i>
                        √ñl√ß√º Ge√ßmi≈üi
                    </h2>
                    <button id="clearMeasurementHistory" class="text-danger hover:bg-danger/10 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-trash-alt mr-2"></i> T√ºm√ºn√º Sil
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Boyun</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bel</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kal√ßa</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Yaƒü %</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Not</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ƒ∞≈ülem</th>
                            </tr>
                        </thead>
                        <tbody id="measurementHistoryTableBody" class="bg-white divide-y divide-gray-100">
                            <!-- Veriler JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                    <div id="emptyMeasurementHistory" class="text-center py-12">
                        <i class="fas fa-ruler text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Hen√ºz hi√ß √∂l√ß√º kaydƒ± yok.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="measurementChartTab" class="measurement-tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-chart-line text-primary mr-3"></i>
                    V√ºcut √ñl√ß√ºleri Grafiƒüi
                </h2>
                <div class="chart-container">
                    <canvas id="measurementChart"></canvas>
                </div>
            </div>
        </div>
        </div>
        <!-- End Body Measurements Section -->

        <!-- Goals Section (Don't Break the Chain) -->
        <div id="goalsSection" class="section-content hidden">
            
            <!-- Motivation Message -->
            <div id="motivationMessage" class="motivation-message hidden">
                <div class="flex items-center gap-3">
                    <i class="fas fa-fire text-2xl"></i>
                    <div>
                        <p class="font-bold text-lg" id="motivationTitle">Harika gidiyorsun!</p>
                        <p class="text-sm opacity-90" id="motivationText">Zincirini kƒ±rmaya devam et! üî•</p>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                <div class="bg-white rounded-xl shadow-soft p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">Aktif Hedefler</p>
                            <p class="text-3xl font-bold text-primary" id="activeGoalsCount">0</p>
                        </div>
                        <div class="bg-primary/10 p-4 rounded-full">
                            <i class="fas fa-bullseye text-primary text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">En Uzun Seri</p>
                            <p class="text-3xl font-bold text-warning" id="longestStreakCount">0</p>
                        </div>
                        <div class="bg-warning/10 p-4 rounded-full">
                            <i class="fas fa-fire text-warning text-2xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm mb-1">Toplam Tamamlanan</p>
                            <p class="text-3xl font-bold text-success" id="totalCompletedCount">0</p>
                        </div>
                        <div class="bg-success/10 p-4 rounded-full">
                            <i class="fas fa-check-circle text-success text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Goal Button -->
            <div class="mb-6">
                <button id="addGoalBtn" class="w-full md:w-auto bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-all flex items-center justify-center gap-2 shadow-soft">
                    <i class="fas fa-plus-circle"></i>
                    <span>Yeni Hedef Ekle</span>
                </button>
            </div>

            <!-- Goals List -->
            <div id="goalsContainer" class="space-y-6">
                <!-- Goals will be rendered here -->
            </div>

            <!-- Empty State -->
            <div id="emptyGoalsState" class="bg-white rounded-xl shadow-soft p-12 text-center hidden">
                <i class="fas fa-link text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-700 mb-2">Hen√ºz hedef eklemediniz</h3>
                <p class="text-gray-500 mb-6">Zinciri kƒ±rma felsefesiyle alƒ±≈ükanlƒ±k olu≈üturmaya ba≈ülayƒ±n!</p>
                <button onclick="document.getElementById('addGoalBtn').click()" class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-secondary transition-all">
                    <i class="fas fa-plus-circle mr-2"></i>ƒ∞lk Hedefini Ekle
                </button>
            </div>
        </div>
        <!-- End Goals Section -->
    </main>

    <!-- Full Calendar Modal -->
    <div id="fullCalendarModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-medium w-full max-w-4xl mx-4 p-6 transform transition-all my-auto max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-dark">
                    <i class="fas fa-calendar-alt mr-2 text-primary"></i>
                    <span id="calendarGoalTitle">Hedef Takvimi</span>
                </h2>
                <button id="closeCalendarModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- Calendar Navigation -->
            <div class="flex items-center justify-between mb-6">
                <button id="prevCalendarMonth" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="text-center">
                    <h3 id="calendarMonthYear" class="text-lg font-bold text-gray-800"></h3>
                    <p id="calendarGoalFrequency" class="text-sm text-gray-500"></p>
                </div>
                <button id="nextCalendarMonth" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- Period Stats (for weekly/monthly) -->
            <div id="periodStats" class="mb-4 p-4 bg-gradient-to-r from-primary/10 to-secondary/10 rounded-lg hidden">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-2xl font-bold text-primary" id="periodCurrentStreak">0</p>
                        <p class="text-xs text-gray-600">Mevcut Seri</p>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-success" id="periodCompletedCount">0</p>
                        <p class="text-xs text-gray-600">Tamamlanan</p>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-warning" id="periodTotalPeriods">0</p>
                        <p class="text-xs text-gray-600">Toplam Periyot</p>
                    </div>
                </div>
            </div>
            
            <!-- Calendar Grid -->
            <div class="mb-4">
                <!-- Weekday Headers -->
                <div class="grid grid-cols-7 gap-2 mb-2">
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Pzt</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Sal</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">√áar</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Per</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Cum</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Cmt</div>
                    <div class="text-center text-xs font-semibold text-gray-600 py-2">Paz</div>
                </div>
                <!-- Calendar Days -->
                <div id="calendarDaysGrid" class="grid grid-cols-7 gap-2">
                    <!-- Days will be rendered here -->
                </div>
            </div>
            
            <!-- Legend -->
            <div class="flex flex-wrap gap-4 text-sm justify-center p-4 bg-gray-50 rounded-lg">
                <span><span class="inline-block w-4 h-4 bg-success rounded mr-2"></span>Tamamlandƒ±</span>
                <span><span class="inline-block w-4 h-4 bg-danger/30 rounded mr-2"></span>Atlandƒ±</span>
                <span><span class="inline-block w-4 h-4 bg-warning rounded mr-2"></span>Bug√ºn</span>
                <span><span class="inline-block w-4 h-4 bg-gray-200 rounded mr-2"></span>Gelecek</span>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div id="goalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 hidden overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-medium w-full max-w-md mx-4 p-6 transform transition-all my-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-dark">
                    <i class="fas fa-link mr-2 text-primary"></i>
                    <span id="goalModalTitle">Yeni Hedef Ekle</span>
                </h2>
                <button id="closeGoalModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="goalForm" class="space-y-4">
                <input type="hidden" id="goalId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-heading mr-1"></i> Hedef Adƒ± *
                    </label>
                    <input type="text" id="goalName" required placeholder="√ñrn: G√ºnl√ºk 30 dk y√ºr√ºy√º≈ü" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-align-left mr-1"></i> A√ßƒ±klama
                    </label>
                    <textarea id="goalDescription" rows="2" placeholder="Hedef hakkƒ±nda detaylar..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-repeat mr-1"></i> Sƒ±klƒ±k *
                    </label>
                    <select id="goalFrequency" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="daily">G√ºnl√ºk</option>
                        <option value="weekly">Haftalƒ±k</option>
                        <option value="monthly">Aylƒ±k</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Hedefinizi ne sƒ±klƒ±kla ger√ßekle≈ütirmek istiyorsunuz?</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar-start mr-1"></i> Ba≈ülangƒ±√ß *
                        </label>
                        <input type="date" id="goalStartDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-calendar-end mr-1"></i> Biti≈ü *
                        </label>
                        <input type="date" id="goalEndDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-500 mt-1 mr-2"></i>
                        <div class="text-sm text-blue-700">
                            <p class="font-semibold mb-1">Zinciri Kƒ±rma Felsefesi</p>
                            <p class="text-xs">Her g√ºn hedefinizi tamamlayarak zincirinizi uzatƒ±n. Zinciriniz ne kadar uzarsa, onu kƒ±rmamak i√ßin o kadar motive olursunuz! üî•</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-3 pt-4">
                    <button type="button" id="cancelGoalBtn" class="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-all">
                        ƒ∞ptal
                    </button>
                    <button type="submit" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-white rounded-xl shadow-medium p-4 flex items-center space-x-3 transform translate-x-full transition-transform duration-300 z-50">
        <div id="toastIcon" class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fas fa-check text-white"></i>
        </div>
        <div>
            <p id="toastMessage" class="font-medium text-dark"></p>
        </div>
    </div>

    <script>
        // Kullanƒ±cƒ± ID'si olu≈ütur
        const getUserId = () => {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        };

        // Veri depolama i√ßin local storage kullanƒ±mƒ±
        const storage = {
            getWeights: () => {
                const userId = getUserId();
                const key = `weights_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveWeights: (weights) => {
                const userId = getUserId();
                const key = `weights_${userId}`;
                localStorage.setItem(key, JSON.stringify(weights));
            },
            getTargets: () => {
                const userId = getUserId();
                const key = `targets_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveTargets: (targets) => {
                const userId = getUserId();
                const key = `targets_${userId}`;
                localStorage.setItem(key, JSON.stringify(targets));
            },
            getMeasurements: () => {
                const userId = getUserId();
                const key = `measurements_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveMeasurements: (measurements) => {
                const userId = getUserId();
                const key = `measurements_${userId}`;
                localStorage.setItem(key, JSON.stringify(measurements));
            },
            getProfile: () => {
                const userId = getUserId();
                const key = `profile_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || { height: null, gender: null };
            },
            saveProfile: (profile) => {
                const userId = getUserId();
                const key = `profile_${userId}`;
                localStorage.setItem(key, JSON.stringify(profile));
            },
            getMeasurementTargets: () => {
                const userId = getUserId();
                const key = `measurementTargets_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveMeasurementTargets: (targets) => {
                const userId = getUserId();
                const key = `measurementTargets_${userId}`;
                localStorage.setItem(key, JSON.stringify(targets));
            },
            getGoals: () => {
                const userId = getUserId();
                const key = `goals_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveGoals: (goals) => {
                const userId = getUserId();
                const key = `goals_${userId}`;
                localStorage.setItem(key, JSON.stringify(goals));
            }
        };

        // Sayfa y√ºklendiƒüinde √ßalƒ±≈üacak fonksiyonlar
        document.addEventListener('DOMContentLoaded', () => {
            // Kullanƒ±cƒ± ID'sini g√∂ster
            document.getElementById('userDisplay').textContent = getUserId();
            
            // Varsayƒ±lan tarih ve saat ayarla
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().substring(0, 5);
            document.getElementById('measurementDate').valueAsDate = now;
            document.getElementById('measurementTime').value = now.toTimeString().substring(0, 5);
            
            // Load profile data
            loadProfileForm();
            
            // Verileri y√ºkle
            updateStats();
            renderHistory();
            renderTargets();
            initChart();
            updateMeasurementStats();
            renderMeasurementHistory();
            initMeasurementChart();
            
            // Form event listeners
            document.getElementById('weightForm').addEventListener('submit', handleWeightSubmit);
            document.getElementById('targetForm').addEventListener('submit', handleTargetSubmit);
            document.getElementById('measurementForm').addEventListener('submit', handleMeasurementSubmit);
            document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
            document.getElementById('clearHistory').addEventListener('click', clearAllHistory);
            document.getElementById('clearMeasurementHistory').addEventListener('click', clearAllMeasurementHistory);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importData);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);
            
            // Measurement tooltips
            const tooltipIcons = document.querySelectorAll('.info-icon');
            let activeTooltip = null;
            
            tooltipIcons.forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const tooltipId = icon.getAttribute('data-tooltip');
                    const tooltip = document.getElementById(tooltipId);
                    
                    // Close active tooltip if different
                    if (activeTooltip && activeTooltip !== tooltip) {
                        activeTooltip.classList.remove('active');
                    }
                    
                    // Toggle current tooltip
                    tooltip.classList.toggle('active');
                    
                    if (tooltip.classList.contains('active')) {
                        activeTooltip = tooltip;
                        // Position tooltip
                        const iconRect = icon.getBoundingClientRect();
                        tooltip.style.top = (iconRect.bottom + 5) + 'px';
                        tooltip.style.left = (iconRect.left - 10) + 'px';
                    } else {
                        activeTooltip = null;
                    }
                });
            });
            
            // Close tooltips when clicking outside
            document.addEventListener('click', (e) => {
                if (activeTooltip && !e.target.classList.contains('info-icon')) {
                    activeTooltip.classList.remove('active');
                    activeTooltip = null;
                }
            });
            
            // User settings modal
            document.getElementById('userSettingsBtn').addEventListener('click', () => {
                document.getElementById('userSettingsModal').classList.remove('hidden');
            });
            
            document.getElementById('closeSettingsModal').addEventListener('click', () => {
                document.getElementById('userSettingsModal').classList.add('hidden');
            });
            
            // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapat
            document.getElementById('userSettingsModal').addEventListener('click', (e) => {
                if (e.target.id === 'userSettingsModal') {
                    document.getElementById('userSettingsModal').classList.add('hidden');
                }
            });
            
            // Section navigation
            document.getElementById('weightSectionBtn')?.addEventListener('click', () => switchSection('weight'));
            document.getElementById('measurementsSectionBtn')?.addEventListener('click', () => switchSection('measurements'));
            document.getElementById('goalsSectionBtn')?.addEventListener('click', () => switchSection('goals'));
            document.getElementById('mobileWeightSectionBtn')?.addEventListener('click', () => switchSection('weight'));
            document.getElementById('mobileMeasurementsSectionBtn')?.addEventListener('click', () => switchSection('measurements'));
            document.getElementById('mobileGoalsSectionBtn')?.addEventListener('click', () => switchSection('goals'));
            
            // Event delegation for delete buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.delete-weight-btn')) {
                    const id = parseInt(e.target.closest('.delete-weight-btn').dataset.id);
                    deleteWeight(id);
                } else if (e.target.closest('.delete-target-btn')) {
                    const id = parseInt(e.target.closest('.delete-target-btn').dataset.id);
                    deleteTarget(id);
                } else if (e.target.closest('.delete-measurement-btn')) {
                    const id = parseInt(e.target.closest('.delete-measurement-btn').dataset.id);
                    deleteMeasurement(id);
                }
            });
            
            // Set active tab
            document.querySelector('.tab-btn')?.classList.add('bg-primary/10', 'text-primary');
            document.querySelector('.measurement-tab-btn')?.classList.add('bg-primary/10', 'text-primary');
        });

        // T√ºm verileri sil
        function clearAllData() {
            if (confirm('T√ºm verilerinizi silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                const userId = getUserId();
                localStorage.removeItem(`weights_${userId}`);
                localStorage.removeItem(`targets_${userId}`);
                localStorage.removeItem(`measurements_${userId}`);
                localStorage.removeItem(`profile_${userId}`);
                
                updateStats();
                renderHistory();
                renderTargets();
                updateChart();
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                loadProfileForm();
                
                showToast('T√ºm veriler silindi!', 'info');
                document.getElementById('userSettingsModal').classList.add('hidden');
            }
        }

        // Verileri dƒ±≈üa aktar
        function exportData() {
            const userId = getUserId();
            const data = {
                userId: userId,
                weights: storage.getWeights(),
                targets: storage.getTargets(),
                measurements: storage.getMeasurements(),
                profile: storage.getProfile(),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `kilo-takip-${userId}-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Veriler ba≈üarƒ±yla dƒ±≈üa aktarƒ±ldƒ±!', 'success');
        }

        // Verileri i√ße aktar
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.weights && data.targets) {
                        // Yeni verileri y√ºkle
                        storage.saveWeights(data.weights);
                        storage.saveTargets(data.targets);
                        
                        // Measurements verisi varsa onu da y√ºkle (geriye uyumluluk i√ßin kontrol)
                        if (data.measurements) {
                            storage.saveMeasurements(data.measurements);
                        }
                        
                        // Profile verisi varsa onu da y√ºkle
                        if (data.profile) {
                            storage.saveProfile(data.profile);
                        }
                        
                        // Aray√ºz√º g√ºncelle
                        updateStats();
                        renderHistory();
                        renderTargets();
                        updateChart();
                        updateMeasurementStats();
                        renderMeasurementHistory();
                        updateMeasurementChart();
                        loadProfileForm();
                        
                        showToast('Veriler ba≈üarƒ±yla i√ße aktarƒ±ldƒ±!', 'success');
                    } else {
                        showToast('Ge√ßersiz dosya formatƒ±!', 'danger');
                    }
                } catch (error) {
                    showToast('Dosya okunurken hata olu≈ütu!', 'danger');
                }
            };
            reader.readAsText(file);
            
            // Dosya inputunu temizle
            event.target.value = '';
        }

        // Sekme deƒüi≈ütirme fonksiyonu
        function openTab(evt, tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('bg-primary/10', 'text-primary');
                tab.classList.add('text-gray-500');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            evt.currentTarget.classList.add('bg-primary/10', 'text-primary');
            evt.currentTarget.classList.remove('text-gray-500');
            
            if (tabName === 'chartTab') {
                updateChart();
            }
        }

        // Kilo form g√∂nderildiƒüinde
        function handleWeightSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const note = document.getElementById('note').value;
            
            const dateTime = `${date}T${time}`;
            
            const newWeight = {
                id: Date.now(),
                date: date,
                time: time,
                dateTime: dateTime,
                weight: weight,
                note: note
            };
            
            const weights = storage.getWeights();
            weights.push(newWeight);
            weights.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            storage.saveWeights(weights);
            updateStats();
            renderHistory();
            updateChart();
            
            document.getElementById('weightForm').reset();
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().substring(0, 5);
            
            showToast('Kilo kaydƒ± ba≈üarƒ±yla eklendi!', 'success');
        }

        // Hedef form g√∂nderildiƒüinde
        function handleTargetSubmit(e) {
            e.preventDefault();
            
            const targetDate = document.getElementById('targetDate').value;
            const targetWeightValue = document.getElementById('targetWeight').value;
            const targetNeckValue = document.getElementById('targetNeck').value;
            const targetWaistValue = document.getElementById('targetWaist').value;
            const targetHipValue = document.getElementById('targetHip').value;
            const description = document.getElementById('targetDescription').value;
            
            // Check if at least one target is provided
            if (!targetWeightValue && !targetNeckValue && !targetWaistValue && !targetHipValue) {
                showToast('L√ºtfen en az bir hedef deƒüeri girin!', 'error');
                return;
            }
            
            const newTarget = {
                id: Date.now(),
                date: targetDate,
                weight: targetWeightValue ? parseFloat(targetWeightValue) : null,
                neck: targetNeckValue ? parseFloat(targetNeckValue) : null,
                waist: targetWaistValue ? parseFloat(targetWaistValue) : null,
                hip: targetHipValue ? parseFloat(targetHipValue) : null,
                description: description,
                completed: false
            };
            
            const targets = storage.getTargets();
            targets.push(newTarget);
            targets.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            storage.saveTargets(targets);
            renderTargets();
            
            document.getElementById('targetForm').reset();
            
            showToast('Hedef ba≈üarƒ±yla eklendi!', 'success');
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            const weights = storage.getWeights();
            
            if (weights.length === 0) {
                document.getElementById('currentWeight').textContent = '--';
                document.getElementById('startingWeight').textContent = '--';
                document.getElementById('totalChange').textContent = '--';
                return;
            }
            
            const currentWeight = weights[weights.length - 1].weight;
            document.getElementById('currentWeight').textContent = `${currentWeight} kg`;
            
            const startingWeight = weights[0].weight;
            document.getElementById('startingWeight').textContent = `${startingWeight} kg`;
            
            const totalChange = currentWeight - startingWeight;
            const changeElement = document.getElementById('totalChange');
            changeElement.textContent = `${totalChange > 0 ? '+' : ''}${totalChange.toFixed(1)} kg`;
            changeElement.className = totalChange >= 0 ? 'text-3xl font-bold text-danger mt-1' : 'text-3xl font-bold text-success mt-1';
        }

        // Kilo ge√ßmi≈üini render et
        function renderHistory() {
            const weights = storage.getWeights();
            const tableBody = document.getElementById('historyTableBody');
            const emptyState = document.getElementById('emptyHistory');
            
            tableBody.innerHTML = '';
            
            if (weights.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            [...weights].reverse().forEach((weight, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                let changeHtml = '<span class="text-gray-400">--</span>';
                if (index < weights.length - 1) {
                    const prevWeight = weights[weights.length - 1 - index - 1].weight;
                    const change = weight.weight - prevWeight;
                    const changeClass = change > 0 ? 'text-danger' : 'text-success';
                    const changeSymbol = change > 0 ? '+' : '';
                    changeHtml = `<span class="font-medium ${changeClass}">${changeSymbol}${change.toFixed(1)} kg</span>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${formatDate(weight.date)}</div>
                        <div class="text-sm text-gray-500">${weight.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${weight.weight} kg</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${changeHtml}
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${weight.note || '--'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="delete-weight-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all" data-id="${weight.id}">
                            <i class="fas fa-trash-alt"></i> Sil
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Hedefleri render et
        function renderTargets() {
            const targets = storage.getTargets();
            const targetsList = document.getElementById('targetsList');
            const emptyState = document.getElementById('emptyTargets');
            
            targetsList.innerHTML = '';
            
            if (targets.length === 0) {
                targetsList.appendChild(emptyState);
                return;
            }
            
            const weights = storage.getWeights();
            const currentWeight = weights.length > 0 ? weights[weights.length - 1].weight : null;
            const measurements = storage.getMeasurements();
            const currentMeasurement = measurements.length > 0 ? measurements[measurements.length - 1] : null;
            
            targets.forEach(target => {
                const targetItem = document.createElement('div');
                targetItem.className = 'p-6';
                
                const today = new Date();
                const targetDate = new Date(target.date);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Build target details string
                let targetDetails = [];
                if (target.weight) targetDetails.push(`${target.weight} kg`);
                if (target.neck) targetDetails.push(`Boyun: ${target.neck} cm`);
                if (target.waist) targetDetails.push(`Bel: ${target.waist} cm`);
                if (target.hip) targetDetails.push(`Kal√ßa: ${target.hip} cm`);
                const targetDetailsStr = targetDetails.join(' | ');
                
                let progressHtml = '';
                let statusHtml = '';
                
                if (target.weight && currentWeight !== null) {
                    const startingWeight = weights.length > 0 ? weights[0].weight : currentWeight;
                    const totalChange = currentWeight - startingWeight;
                    const targetChange = target.weight - startingWeight;
                    
                    let progressPercent = 0;
                    if (targetChange !== 0) {
                        progressPercent = Math.min(100, Math.max(0, (totalChange / targetChange) * 100));
                    }
                    
                    progressHtml = `
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-primary h-2.5 rounded-full" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${progressPercent.toFixed(1)}% tamamlandƒ±</div>
                    `;
                    
                    if (diffDays < 0) {
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger/10 text-danger">Tarihi ge√ßti</span>`;
                    } else if (Math.abs(currentWeight - target.weight) < 0.1) {
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success/10 text-success">Hedefe ula≈üƒ±ldƒ±!</span>`;
                    } else if (currentWeight > target.weight) {
                        const remaining = currentWeight - target.weight;
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger/10 text-danger">Hedefe ${remaining.toFixed(1)} kg kaldƒ±</span>`;
                    } else {
                        const remaining = target.weight - currentWeight;
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success/10 text-success">Hedefe ${remaining.toFixed(1)} kg kaldƒ±</span>`;
                    }
                } else {
                    progressHtml = `
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-gray-400 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    `;
                    statusHtml = '<span class="text-gray-500 text-sm">Veri yok</span>';
                }
                
                // Build measurement status HTML
                let measurementStatusHtml = '';
                if (currentMeasurement) {
                    let measurementStatuses = [];
                    
                    if (target.neck) {
                        const diff = currentMeasurement.neck - target.neck;
                        if (Math.abs(diff) < 0.1) {
                            measurementStatuses.push(`<span class="text-xs text-success">‚úì Boyun hedefe ula≈ütƒ±</span>`);
                        } else {
                            const remaining = Math.abs(diff);
                            const status = diff > 0 ? `${remaining.toFixed(1)} cm fazla` : `${remaining.toFixed(1)} cm kaldƒ±`;
                            measurementStatuses.push(`<span class="text-xs text-gray-600">Boyun: ${status}</span>`);
                        }
                    }
                    
                    if (target.waist) {
                        const diff = currentMeasurement.waist - target.waist;
                        if (Math.abs(diff) < 0.1) {
                            measurementStatuses.push(`<span class="text-xs text-success">‚úì Bel hedefe ula≈ütƒ±</span>`);
                        } else {
                            const remaining = Math.abs(diff);
                            const status = diff > 0 ? `${remaining.toFixed(1)} cm fazla` : `${remaining.toFixed(1)} cm kaldƒ±`;
                            measurementStatuses.push(`<span class="text-xs text-gray-600">Bel: ${status}</span>`);
                        }
                    }
                    
                    if (target.hip) {
                        const diff = currentMeasurement.hip - target.hip;
                        if (Math.abs(diff) < 0.1) {
                            measurementStatuses.push(`<span class="text-xs text-success">‚úì Kal√ßa hedefe ula≈ütƒ±</span>`);
                        } else {
                            const remaining = Math.abs(diff);
                            const status = diff > 0 ? `${remaining.toFixed(1)} cm fazla` : `${remaining.toFixed(1)} cm kaldƒ±`;
                            measurementStatuses.push(`<span class="text-xs text-gray-600">Kal√ßa: ${status}</span>`);
                        }
                    }
                    
                    if (measurementStatuses.length > 0) {
                        measurementStatusHtml = `<div class="mt-2 space-y-1">${measurementStatuses.join('<br>')}</div>`;
                    }
                }
                
                targetItem.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-start md:justify-between">
                        <div class="mb-4 md:mb-0 md:flex-1">
                            <div class="flex items-center">
                                <div class="bg-primary/10 p-2 rounded-lg mr-3">
                                    <i class="fas fa-bullseye text-primary"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold">${formatDate(target.date)}</h3>
                                    <p class="text-gray-600 text-sm">${targetDetailsStr}</p>
                                    ${target.description ? `<p class="text-gray-500 text-xs mt-1">${target.description}</p>` : ''}
                                </div>
                            </div>
                            ${progressHtml}
                            ${measurementStatusHtml}
                        </div>
                        <div class="flex flex-col items-end">
                            <div class="mb-2">${statusHtml}</div>
                            <div class="text-sm text-gray-500 mb-3">${diffDays >= 0 ? `${diffDays} g√ºn kaldƒ±` : 'S√ºresi doldu'}</div>
                            <button class="delete-target-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all text-sm" data-id="${target.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Sil
                            </button>
                        </div>
                    </div>
                `;
                
                targetsList.appendChild(targetItem);
            });
        }

        // Grafiƒüi ba≈ülat
        let weightChart;
        function initChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Kilo (kg)',
                        data: [],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#4f46e5',
                        pointRadius: 5,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `Kilo: ${context.parsed.y} kg`;
                                }
                            }
                        }
                    }
                }
            });
            
            updateChart();
        }

        // Grafiƒüi g√ºncelle
        function updateChart() {
            if (!weightChart) return;
            
            const weights = storage.getWeights();
            const targets = storage.getTargets();
            
            const labels = weights.map(w => formatDate(w.date));
            const data = weights.map(w => w.weight);
            
            const datasets = [{
                label: 'Kilo (kg)',
                data: data,
                borderColor: '#4f46e5',
                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                borderWidth: 3,
                pointBackgroundColor: '#4f46e5',
                pointRadius: 5,
                tension: 0.3,
                fill: true
            }];
            
            const colors = ['#10b981', '#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6'];
            
            targets.forEach((target, index) => {
                const targetIndex = labels.findIndex(label => label === formatDate(target.date));
                
                if (targetIndex !== -1) {
                    datasets.push({
                        label: `Hedef ${index + 1}: ${target.weight} kg`,
                        data: Array(targetIndex).fill(null).concat([target.weight]),
                        borderColor: colors[index % colors.length],
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointBackgroundColor: colors[index % colors.length],
                        pointRadius: 6,
                        pointStyle: 'rectRot',
                        fill: false
                    });
                }
                
                datasets.push({
                    label: `Hedef Kilo: ${target.weight} kg`,
                    data: Array(labels.length).fill(target.weight),
                    borderColor: colors[index % colors.length],
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                });
            });
            
            weightChart.data.labels = labels;
            weightChart.data.datasets = datasets;
            weightChart.update();
        }

        // Kilo kaydƒ±nƒ± sil
        function deleteWeight(id) {
            if (confirm('Bu kilo kaydƒ±nƒ± silmek istediƒüinizden emin misiniz?')) {
                let weights = storage.getWeights();
                weights = weights.filter(w => w.id !== id);
                storage.saveWeights(weights);
                
                updateStats();
                renderHistory();
                updateChart();
                
                showToast('Kilo kaydƒ± silindi!', 'info');
            }
        }

        // Hedefi sil
        function deleteTarget(id) {
            if (confirm('Bu hedefi silmek istediƒüinizden emin misiniz?')) {
                let targets = storage.getTargets();
                targets = targets.filter(t => t.id !== id);
                storage.saveTargets(targets);
                
                renderTargets();
                updateChart();
                
                showToast('Hedef silindi!', 'info');
            }
        }

        // T√ºm ge√ßmi≈üi sil
        function clearAllHistory() {
            if (confirm('T√ºm kilo ge√ßmi≈üini silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                storage.saveWeights([]);
                updateStats();
                renderHistory();
                updateChart();
                
                showToast('T√ºm kilo ge√ßmi≈üi silindi!', 'info');
            }
        }

        // Tarih formatla
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('tr-TR', options);
        }

        // Toast bildirim g√∂ster
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-success';
                toastIcon.innerHTML = '<i class="fas fa-check text-white"></i>';
            } else if (type === 'danger') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-danger';
                toastIcon.innerHTML = '<i class="fas fa-times text-white"></i>';
            } else if (type === 'warning') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-warning';
                toastIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-white"></i>';
            } else {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-primary';
                toastIcon.innerHTML = '<i class="fas fa-info text-white"></i>';
            }
            
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 5000);
        }

        // ============= PROFILE FUNCTIONS =============
        
        // Load profile form data
        function loadProfileForm() {
            const profile = storage.getProfile();
            if (profile.height) {
                document.getElementById('userHeight').value = profile.height;
            }
            if (profile.gender) {
                document.getElementById('userGender').value = profile.gender;
            }
        }
        
        // Handle profile form submit
        function handleProfileSubmit(e) {
            e.preventDefault();
            
            const height = parseFloat(document.getElementById('userHeight').value);
            const gender = document.getElementById('userGender').value;
            
            if (!height || !gender) {
                showToast('L√ºtfen t√ºm alanlarƒ± doldurun!', 'danger');
                return;
            }
            
            const profile = {
                height: height,
                gender: gender
            };
            
            storage.saveProfile(profile);
            updateMeasurementStats();
            renderMeasurementHistory();
            
            showToast('Profil bilgileri kaydedildi!', 'success');
        }
        
        // Calculate body fat percentage using U.S. Navy method
        function calculateBodyFat(neck, waist, hip, height, gender) {
            if (!height || !gender || !neck || !waist || !hip) {
                return null;
            }
            
            let bodyFat;
            
            if (gender === 'male') {
                // Men's formula: BF% = 495 / (1.0324 - 0.19077 * log10(waist - neck) + 0.15456 * log10(height)) - 450
                const value = 1.0324 - 0.19077 * Math.log10(waist - neck) + 0.15456 * Math.log10(height);
                bodyFat = 495 / value - 450;
            } else if (gender === 'female') {
                // Women's formula: BF% = 495 / (1.29579 - 0.35004 * log10(waist + hip - neck) + 0.22100 * log10(height)) - 450
                const value = 1.29579 - 0.35004 * Math.log10(waist + hip - neck) + 0.22100 * Math.log10(height);
                bodyFat = 495 / value - 450;
            }
            
            // Ensure result is within reasonable bounds
            if (bodyFat < 0) bodyFat = 0;
            if (bodyFat > 100) bodyFat = 100;
            
            return bodyFat;
        }

        // ============= MEASUREMENTS SECTION FUNCTIONS =============

        // Switch between sections
        function switchSection(section) {
            const weightSection = document.getElementById('weightSection');
            const measurementsSection = document.getElementById('measurementsSection');
            const goalsSection = document.getElementById('goalsSection');
            const mobileNav = document.getElementById('mobileNav');
            const mobileMeasurementNav = document.getElementById('mobileMeasurementNav');
            
            // Hide all sections first
            weightSection.classList.add('hidden');
            measurementsSection.classList.add('hidden');
            goalsSection.classList.add('hidden');
            mobileNav.classList.add('hidden');
            mobileMeasurementNav.classList.add('hidden');
            
            // Reset all button styles
            document.getElementById('weightSectionBtn')?.classList.remove('bg-white/20');
            document.getElementById('measurementsSectionBtn')?.classList.remove('bg-white/20');
            document.getElementById('goalsSectionBtn')?.classList.remove('bg-white/20');
            
            document.getElementById('mobileWeightSectionBtn')?.classList.remove('bg-primary/10', 'text-primary');
            document.getElementById('mobileWeightSectionBtn')?.classList.add('text-gray-500');
            document.getElementById('mobileMeasurementsSectionBtn')?.classList.remove('bg-primary/10', 'text-primary');
            document.getElementById('mobileMeasurementsSectionBtn')?.classList.add('text-gray-500');
            document.getElementById('mobileGoalsSectionBtn')?.classList.remove('bg-primary/10', 'text-primary');
            document.getElementById('mobileGoalsSectionBtn')?.classList.add('text-gray-500');
            
            // Show selected section
            if (section === 'weight') {
                weightSection.classList.remove('hidden');
                mobileNav.classList.remove('hidden');
                document.getElementById('weightSectionBtn')?.classList.add('bg-white/20');
                document.getElementById('mobileWeightSectionBtn')?.classList.add('bg-primary/10', 'text-primary');
                document.getElementById('mobileWeightSectionBtn')?.classList.remove('text-gray-500');
            } else if (section === 'measurements') {
                measurementsSection.classList.remove('hidden');
                mobileMeasurementNav.classList.remove('hidden');
                document.getElementById('measurementsSectionBtn')?.classList.add('bg-white/20');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.add('bg-primary/10', 'text-primary');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.remove('text-gray-500');
                updateMeasurementChart();
            } else if (section === 'goals') {
                goalsSection.classList.remove('hidden');
                document.getElementById('goalsSectionBtn')?.classList.add('bg-white/20');
                document.getElementById('mobileGoalsSectionBtn')?.classList.add('bg-primary/10', 'text-primary');
                document.getElementById('mobileGoalsSectionBtn')?.classList.remove('text-gray-500');
                renderGoals();
                updateGoalsStats();
            }
        }

        // √ñl√ß√º sekmesi deƒüi≈ütirme fonksiyonu
        function openMeasurementTab(evt, tabName) {
            const tabContents = document.querySelectorAll('.measurement-tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            const tabs = document.querySelectorAll('.measurement-tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('bg-primary/10', 'text-primary');
                tab.classList.add('text-gray-500');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            evt.currentTarget.classList.add('bg-primary/10', 'text-primary');
            evt.currentTarget.classList.remove('text-gray-500');
            
            if (tabName === 'measurementChartTab') {
                updateMeasurementChart();
            }
        }

        // √ñl√ß√º form g√∂nderildiƒüinde
        function handleMeasurementSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('measurementDate').value;
            const time = document.getElementById('measurementTime').value;
            const neckInput = document.getElementById('neck').value;
            const waistInput = document.getElementById('waist').value;
            const hipInput = document.getElementById('hip').value;
            const note = document.getElementById('measurementNote').value;
            
            // Validate all measurements are filled
            if (!neckInput || !waistInput || !hipInput) {
                showToast('L√ºtfen t√ºm √∂l√ß√º alanlarƒ±nƒ± doldurun!', 'danger');
                return;
            }
            
            const neck = parseFloat(neckInput);
            const waist = parseFloat(waistInput);
            const hip = parseFloat(hipInput);
            
            // Check if profile info is available for body fat calculation
            const profile = storage.getProfile();
            let bodyFat = null;
            let showWarning = false;
            
            if (!profile.height || !profile.gender) {
                showWarning = true;
            } else {
                bodyFat = calculateBodyFat(neck, waist, hip, profile.height, profile.gender);
            }
            
            const dateTime = `${date}T${time}`;
            
            const newMeasurement = {
                id: Date.now(),
                date: date,
                time: time,
                dateTime: dateTime,
                neck: neck,
                waist: waist,
                hip: hip,
                bodyFat: bodyFat,
                note: note
            };
            
            const measurements = storage.getMeasurements();
            measurements.push(newMeasurement);
            measurements.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            storage.saveMeasurements(measurements);
            updateMeasurementStats();
            renderMeasurementHistory();
            updateMeasurementChart();
            
            document.getElementById('measurementForm').reset();
            const now = new Date();
            document.getElementById('measurementDate').valueAsDate = now;
            document.getElementById('measurementTime').value = now.toTimeString().substring(0, 5);
            
            if (showWarning) {
                showToast('√ñl√ß√º kaydedildi! ‚ö†Ô∏è V√ºcut yaƒü oranƒ± hesaplanamadƒ±. L√ºtfen ayarlardan boy ve cinsiyet bilgilerinizi girin.', 'warning');
            } else {
                showToast('√ñl√ß√º kaydƒ± ba≈üarƒ±yla eklendi!', 'success');
            }
        }

        // √ñl√ß√º istatistiklerini g√ºncelle
        function updateMeasurementStats() {
            const measurements = storage.getMeasurements();
            
            if (measurements.length === 0) {
                document.getElementById('currentNeck').textContent = '--';
                document.getElementById('currentWaist').textContent = '--';
                document.getElementById('currentHip').textContent = '--';
                document.getElementById('currentBodyFat').textContent = '--';
                document.getElementById('neckDiff').textContent = '';
                document.getElementById('waistDiff').textContent = '';
                document.getElementById('hipDiff').textContent = '';
                return;
            }
            
            const latest = measurements[measurements.length - 1];
            const first = measurements[0];
            const profile = storage.getProfile();
            
            // Helper function to display difference
            function displayDiff(currentValue, initialValue, elementId) {
                const diff = currentValue - initialValue;
                const diffElement = document.getElementById(elementId);
                
                if (Math.abs(diff) < 0.01) {
                    // No significant change
                    diffElement.textContent = '';
                } else {
                    const sign = diff > 0 ? '+' : '';
                    const color = diff < 0 ? '#10b981' : '#ef4444'; // green for decrease, red for increase
                    diffElement.textContent = `(${sign}${diff.toFixed(1)})`;
                    diffElement.style.color = color;
                }
            }
            
            document.getElementById('currentNeck').textContent = `${latest.neck} cm`;
            document.getElementById('currentWaist').textContent = `${latest.waist} cm`;
            document.getElementById('currentHip').textContent = `${latest.hip} cm`;
            
            // Display differences from initial measurements
            if (measurements.length > 1) {
                displayDiff(latest.neck, first.neck, 'neckDiff');
                displayDiff(latest.waist, first.waist, 'waistDiff');
                displayDiff(latest.hip, first.hip, 'hipDiff');
            } else {
                document.getElementById('neckDiff').textContent = '';
                document.getElementById('waistDiff').textContent = '';
                document.getElementById('hipDiff').textContent = '';
            }
            
            // Calculate or recalculate body fat if possible
            let bodyFat = latest.bodyFat;
            if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                bodyFat = calculateBodyFat(latest.neck, latest.waist, latest.hip, profile.height, profile.gender);
            }
            
            if (bodyFat !== null && bodyFat !== undefined) {
                document.getElementById('currentBodyFat').textContent = `${bodyFat.toFixed(1)}%`;
            } else {
                document.getElementById('currentBodyFat').textContent = '--';
            }
        }

        // √ñl√ß√º ge√ßmi≈üini render et
        function renderMeasurementHistory() {
            const measurements = storage.getMeasurements();
            const tableBody = document.getElementById('measurementHistoryTableBody');
            const emptyState = document.getElementById('emptyMeasurementHistory');
            const profile = storage.getProfile();
            
            tableBody.innerHTML = '';
            
            if (measurements.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            [...measurements].reverse().forEach((measurement) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                // Calculate or recalculate body fat if possible
                let bodyFat = measurement.bodyFat;
                if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                    bodyFat = calculateBodyFat(measurement.neck, measurement.waist, measurement.hip, profile.height, profile.gender);
                }
                
                let bodyFatDisplay = '--';
                if (bodyFat !== null && bodyFat !== undefined) {
                    bodyFatDisplay = `<div class="text-sm font-medium text-success">${bodyFat.toFixed(1)}%</div>`;
                } else {
                    bodyFatDisplay = `<div class="text-sm text-gray-400">N/A</div>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${formatDate(measurement.date)}</div>
                        <div class="text-sm text-gray-500">${measurement.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.neck} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.waist} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.hip} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${bodyFatDisplay}
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${measurement.note || '--'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="delete-measurement-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all" data-id="${measurement.id}">
                            <i class="fas fa-trash-alt"></i> Sil
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // √ñl√ß√º kaydƒ±nƒ± sil
        function deleteMeasurement(id) {
            if (confirm('Bu √∂l√ß√º kaydƒ±nƒ± silmek istediƒüinizden emin misiniz?')) {
                let measurements = storage.getMeasurements();
                measurements = measurements.filter(m => m.id !== id);
                storage.saveMeasurements(measurements);
                
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                
                showToast('√ñl√ß√º kaydƒ± silindi!', 'info');
            }
        }

        // T√ºm √∂l√ß√º ge√ßmi≈üini sil
        function clearAllMeasurementHistory() {
            if (confirm('T√ºm √∂l√ß√º ge√ßmi≈üini silmek istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                storage.saveMeasurements([]);
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                
                showToast('T√ºm √∂l√ß√º ge√ßmi≈üi silindi!', 'info');
            }
        }

        // √ñl√ß√º grafiƒüini ba≈ülat
        let measurementChart;
        function initMeasurementChart() {
            const ctx = document.getElementById('measurementChart').getContext('2d');
            measurementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Boyun (cm)',
                            data: [],
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#4f46e5',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Bel (cm)',
                            data: [],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Kal√ßa (cm)',
                            data: [],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#f59e0b',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'V√ºcut Yaƒü % ',
                            data: [],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#10b981',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: false,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            title: {
                                display: true,
                                text: '√ñl√ß√º (cm)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            grid: { 
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: 'Yaƒü Oranƒ± (%)'
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8
                        }
                    }
                }
            });
            
            updateMeasurementChart();
        }

        // √ñl√ß√º grafiƒüini g√ºncelle
        function updateMeasurementChart() {
            if (!measurementChart) return;
            
            const measurements = storage.getMeasurements();
            const profile = storage.getProfile();
            
            const labels = measurements.map(m => formatDate(m.date));
            const neckData = measurements.map(m => m.neck);
            const waistData = measurements.map(m => m.waist);
            const hipData = measurements.map(m => m.hip);
            
            // Calculate body fat for each measurement
            const bodyFatData = measurements.map(m => {
                let bodyFat = m.bodyFat;
                if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                    bodyFat = calculateBodyFat(m.neck, m.waist, m.hip, profile.height, profile.gender);
                }
                return bodyFat;
            });
            
            measurementChart.data.labels = labels;
            measurementChart.data.datasets[0].data = neckData;
            measurementChart.data.datasets[1].data = waistData;
            measurementChart.data.datasets[2].data = hipData;
            measurementChart.data.datasets[3].data = bodyFatData;
            measurementChart.update();
        }

        // ============= GOALS SECTION (DON'T BREAK THE CHAIN) =============

        // Goal modal event listeners
        document.getElementById('addGoalBtn')?.addEventListener('click', () => {
            openGoalModal();
        });

        document.getElementById('closeGoalModal')?.addEventListener('click', () => {
            closeGoalModal();
        });

        document.getElementById('cancelGoalBtn')?.addEventListener('click', () => {
            closeGoalModal();
        });

        document.getElementById('goalForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            saveGoal();
        });

        // Open goal modal
        function openGoalModal(goalId = null) {
            const modal = document.getElementById('goalModal');
            const form = document.getElementById('goalForm');
            const title = document.getElementById('goalModalTitle');
            
            form.reset();
            
            if (goalId) {
                const goals = storage.getGoals();
                const goal = goals.find(g => g.id === goalId);
                
                if (goal) {
                    document.getElementById('goalId').value = goal.id;
                    document.getElementById('goalName').value = goal.name;
                    document.getElementById('goalDescription').value = goal.description || '';
                    document.getElementById('goalFrequency').value = goal.frequency;
                    document.getElementById('goalStartDate').value = goal.startDate;
                    document.getElementById('goalEndDate').value = goal.endDate;
                    title.textContent = 'Hedef D√ºzenle';
                }
            } else {
                document.getElementById('goalId').value = '';
                title.textContent = 'Yeni Hedef Ekle';
                
                // Set default start date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('goalStartDate').value = today;
                
                // Set default end date to 30 days from now
                const endDate = new Date();
                endDate.setDate(endDate.getDate() + 30);
                document.getElementById('goalEndDate').value = endDate.toISOString().split('T')[0];
            }
            
            modal.classList.remove('hidden');
        }

        // Close goal modal
        function closeGoalModal() {
            document.getElementById('goalModal').classList.add('hidden');
        }

        // Save goal
        function saveGoal() {
            const goalId = document.getElementById('goalId').value;
            const name = document.getElementById('goalName').value.trim();
            const description = document.getElementById('goalDescription').value.trim();
            const frequency = document.getElementById('goalFrequency').value;
            const startDate = document.getElementById('goalStartDate').value;
            const endDate = document.getElementById('goalEndDate').value;
            
            if (!name || !frequency || !startDate || !endDate) {
                showToast('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }
            
            if (new Date(endDate) < new Date(startDate)) {
                showToast('Biti≈ü tarihi ba≈ülangƒ±√ß tarihinden √∂nce olamaz!', 'error');
                return;
            }
            
            const goals = storage.getGoals();
            
            if (goalId) {
                // Update existing goal
                const index = goals.findIndex(g => g.id === parseInt(goalId));
                if (index !== -1) {
                    goals[index] = {
                        ...goals[index],
                        name,
                        description,
                        frequency,
                        startDate,
                        endDate,
                        updatedAt: new Date().toISOString()
                    };
                    showToast('Hedef g√ºncellendi!', 'success');
                }
            } else {
                // Create new goal
                const newGoal = {
                    id: Date.now(),
                    name,
                    description,
                    frequency,
                    startDate,
                    endDate,
                    completions: [], // Array of completion dates
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                goals.push(newGoal);
                showToast('Yeni hedef eklendi! üéØ', 'success');
            }
            
            storage.saveGoals(goals);
            closeGoalModal();
            renderGoals();
            updateGoalsStats();
        }

        // Delete goal
        function deleteGoal(goalId) {
            if (!confirm('Bu hedefi silmek istediƒüinizden emin misiniz?')) {
                return;
            }
            
            let goals = storage.getGoals();
            goals = goals.filter(g => g.id !== goalId);
            storage.saveGoals(goals);
            
            renderGoals();
            updateGoalsStats();
            showToast('Hedef silindi!', 'info');
        }

        // Toggle completion for a day
        function toggleGoalCompletion(goalId, dateStr) {
            const goals = storage.getGoals();
            const goal = goals.find(g => g.id === goalId);
            
            if (!goal) return;
            
            const today = new Date().toISOString().split('T')[0];
            const clickedDate = new Date(dateStr);
            const todayDate = new Date(today);
            
            // Don't allow marking future dates
            if (clickedDate > todayDate) {
                showToast('Gelecekteki g√ºnleri i≈üaretleyemezsiniz!', 'warning');
                return;
            }
            
            const completionIndex = goal.completions.indexOf(dateStr);
            const isRemoving = completionIndex > -1;
            
            // Get dates to toggle based on frequency
            const datesToToggle = [];
            
            if (goal.frequency === 'weekly') {
                // Get all days in the week of the clicked date
                const weekStart = getWeekStart(clickedDate);
                const goalStart = new Date(goal.startDate);
                goalStart.setHours(0, 0, 0, 0);
                const goalEnd = new Date(goal.endDate);
                goalEnd.setHours(0, 0, 0, 0);
                
                for (let i = 0; i < 7; i++) {
                    const currentDay = new Date(weekStart);
                    currentDay.setDate(weekStart.getDate() + i);
                    
                    // Only include days within goal period and not in the future
                    if (currentDay >= goalStart && currentDay <= goalEnd && currentDay <= todayDate) {
                        datesToToggle.push(currentDay.toISOString().split('T')[0]);
                    }
                }
            } else if (goal.frequency === 'monthly') {
                // Get all days in the month of the clicked date
                const monthStart = new Date(clickedDate.getFullYear(), clickedDate.getMonth(), 1);
                const monthEnd = new Date(clickedDate.getFullYear(), clickedDate.getMonth() + 1, 0);
                const goalStart = new Date(goal.startDate);
                goalStart.setHours(0, 0, 0, 0);
                const goalEnd = new Date(goal.endDate);
                goalEnd.setHours(0, 0, 0, 0);
                
                for (let day = 1; day <= monthEnd.getDate(); day++) {
                    const currentDay = new Date(clickedDate.getFullYear(), clickedDate.getMonth(), day);
                    
                    // Only include days within goal period and not in the future
                    if (currentDay >= goalStart && currentDay <= goalEnd && currentDay <= todayDate) {
                        datesToToggle.push(currentDay.toISOString().split('T')[0]);
                    }
                }
            } else {
                // Daily frequency - just toggle the single day
                datesToToggle.push(dateStr);
            }
            
            if (isRemoving) {
                // Remove all dates in the period
                datesToToggle.forEach(date => {
                    const index = goal.completions.indexOf(date);
                    if (index > -1) {
                        goal.completions.splice(index, 1);
                    }
                });
                
                if (goal.frequency === 'weekly') {
                    showToast('Haftalƒ±k tamamlanma i≈üaretleri kaldƒ±rƒ±ldƒ±', 'info');
                } else if (goal.frequency === 'monthly') {
                    showToast('Aylƒ±k tamamlanma i≈üaretleri kaldƒ±rƒ±ldƒ±', 'info');
                } else {
                    showToast('Tamamlanma i≈üareti kaldƒ±rƒ±ldƒ±', 'info');
                }
            } else {
                // Add all dates in the period
                datesToToggle.forEach(date => {
                    if (!goal.completions.includes(date)) {
                        goal.completions.push(date);
                    }
                });
                goal.completions.sort();
                
                // Check if this creates/extends a streak
                const currentStreak = getCurrentStreak(goal);
                const streakUnit = goal.frequency === 'daily' ? 'g√ºnl√ºk' : 
                                   goal.frequency === 'weekly' ? 'haftalƒ±k' : 'aylƒ±k';
                
                if (currentStreak >= 3) {
                    showToast(`Harika! ${currentStreak} ${streakUnit} serin var! üî•`, 'success');
                } else if (goal.frequency === 'weekly') {
                    showToast(`Hafta tamamlandƒ± olarak i≈üaretlendi! ‚úì (${datesToToggle.length} g√ºn)`, 'success');
                } else if (goal.frequency === 'monthly') {
                    showToast(`Ay tamamlandƒ± olarak i≈üaretlendi! ‚úì (${datesToToggle.length} g√ºn)`, 'success');
                } else {
                    showToast('Tamamlandƒ± olarak i≈üaretlendi! ‚úì', 'success');
                }
            }
            
            goal.updatedAt = new Date().toISOString();
            storage.saveGoals(goals);
            renderGoals();
            updateGoalsStats();
            
            // Update calendar if open
            if (currentCalendarGoal && currentCalendarGoal.id === goalId) {
                currentCalendarGoal = goals.find(g => g.id === goalId);
                renderFullCalendar();
            }
        }

        // Get current streak for a goal
        function getCurrentStreak(goal) {
            if (!goal.completions || goal.completions.length === 0) {
                return 0;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            let currentDate = new Date(today);
            let streak = 0;
            
            const sortedCompletions = [...goal.completions].sort().reverse();
            const completionDates = sortedCompletions.map(d => new Date(d).getTime());
            
            // Check based on frequency
            if (goal.frequency === 'daily') {
                while (true) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    if (goal.completions.includes(dateStr)) {
                        streak++;
                        currentDate.setDate(currentDate.getDate() - 1);
                    } else {
                        // For daily goals, allow missing today if streak starts yesterday
                        if (streak === 0 && currentDate.getTime() === today.getTime()) {
                            currentDate.setDate(currentDate.getDate() - 1);
                            continue;
                        }
                        break;
                    }
                    
                    // Don't count days before goal start
                    if (currentDate < new Date(goal.startDate)) {
                        break;
                    }
                }
            } else if (goal.frequency === 'weekly') {
                // For weekly goals, count consecutive weeks with at least one completion
                let weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay()); // Start of current week
                
                while (true) {
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    
                    const hasCompletionInWeek = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= weekStart && compDate <= weekEnd;
                    });
                    
                    if (hasCompletionInWeek) {
                        streak++;
                        weekStart.setDate(weekStart.getDate() - 7);
                    } else {
                        break;
                    }
                    
                    if (weekStart < new Date(goal.startDate)) {
                        break;
                    }
                }
            } else if (goal.frequency === 'monthly') {
                // For monthly goals, count consecutive months with at least one completion
                let monthDate = new Date(today.getFullYear(), today.getMonth(), 1);
                
                while (true) {
                    const monthStart = new Date(monthDate);
                    const monthEnd = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0);
                    
                    const hasCompletionInMonth = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= monthStart && compDate <= monthEnd;
                    });
                    
                    if (hasCompletionInMonth) {
                        streak++;
                        monthDate.setMonth(monthDate.getMonth() - 1);
                    } else {
                        break;
                    }
                    
                    if (monthDate < new Date(goal.startDate)) {
                        break;
                    }
                }
            }
            
            return streak;
        }

        // Get longest streak for a goal
        function getLongestStreak(goal) {
            if (!goal.completions || goal.completions.length === 0) {
                return 0;
            }
            
            let maxStreak = 0;
            let currentStreak = 0;
            const sortedCompletions = [...goal.completions].sort();
            
            if (goal.frequency === 'daily') {
                for (let i = 0; i < sortedCompletions.length; i++) {
                    if (i === 0) {
                        currentStreak = 1;
                    } else {
                        const prevDate = new Date(sortedCompletions[i - 1]);
                        const currDate = new Date(sortedCompletions[i]);
                        const diffDays = Math.floor((currDate - prevDate) / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 1) {
                            currentStreak++;
                        } else {
                            maxStreak = Math.max(maxStreak, currentStreak);
                            currentStreak = 1;
                        }
                    }
                }
                maxStreak = Math.max(maxStreak, currentStreak);
            } else {
                // For weekly/monthly, just count total completions as streak indicator
                maxStreak = sortedCompletions.length;
            }
            
            return maxStreak;
        }

        // Render goals
        function renderGoals() {
            const goals = storage.getGoals();
            const container = document.getElementById('goalsContainer');
            const emptyState = document.getElementById('emptyGoalsState');
            
            container.innerHTML = '';
            
            if (goals.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // Sort goals: active first, then by creation date
            const sortedGoals = goals.sort((a, b) => {
                const aActive = isGoalActive(a);
                const bActive = isGoalActive(b);
                
                if (aActive && !bActive) return -1;
                if (!aActive && bActive) return 1;
                
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            sortedGoals.forEach(goal => {
                const goalCard = createGoalCard(goal);
                container.appendChild(goalCard);
            });
            
            // Update motivation message
            updateMotivationMessage();
        }

        // Check if goal is active
        function isGoalActive(goal) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const start = new Date(goal.startDate);
            const end = new Date(goal.endDate);
            
            return today >= start && today <= end;
        }

        // Create goal card
        function createGoalCard(goal) {
            const card = document.createElement('div');
            card.className = 'goal-card';
            
            const currentStreak = getCurrentStreak(goal);
            const longestStreak = getLongestStreak(goal);
            const isActive = isGoalActive(goal);
            const completionRate = calculateCompletionRate(goal);
            
            const frequencyText = {
                'daily': 'G√ºnl√ºk',
                'weekly': 'Haftalƒ±k',
                'monthly': 'Aylƒ±k'
            };
            
            const statusBadge = isActive 
                ? '<span class="bg-green-100 text-green-800 text-xs px-3 py-1 rounded-full font-medium">Aktif</span>'
                : '<span class="bg-gray-100 text-gray-600 text-xs px-3 py-1 rounded-full font-medium">Tamamlandƒ±</span>';
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">${escapeHtml(goal.name)}</h3>
                        ${goal.description ? `<p class="text-sm text-gray-600 mb-2">${escapeHtml(goal.description)}</p>` : ''}
                        <div class="flex flex-wrap gap-2 items-center">
                            ${statusBadge}
                            <span class="text-xs text-gray-500">
                                <i class="fas fa-repeat mr-1"></i>${frequencyText[goal.frequency]}
                            </span>
                            <span class="text-xs text-gray-500">
                                <i class="fas fa-calendar mr-1"></i>${formatDate(goal.startDate)} - ${formatDate(goal.endDate)}
                            </span>
                        </div>
                    </div>
                    <div class="flex gap-2 ml-4">
                        <button onclick="openGoalModal(${goal.id})" class="text-primary hover:text-secondary transition-all p-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteGoal(${goal.id})" class="text-danger hover:text-red-600 transition-all p-2">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Streak Stats -->
                <div class="grid grid-cols-3 gap-3 mb-4 p-3 bg-gray-50 rounded-lg">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-warning">${currentStreak}</p>
                        <p class="text-xs text-gray-600">Mevcut Seri</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-primary">${longestStreak}</p>
                        <p class="text-xs text-gray-600">En Uzun Seri</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-success">${completionRate}%</p>
                        <p class="text-xs text-gray-600">Ba≈üarƒ± Oranƒ±</p>
                    </div>
                </div>
                
                <!-- Chain Visualization -->
                <div class="mb-3">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-semibold text-gray-700 flex items-center gap-2">
                            <i class="fas fa-link"></i>
                            Zincir G√∂r√ºn√ºm√º
                            ${currentStreak >= 3 ? '<span class="text-lg">üî•</span>' : ''}
                        </h4>
                        <span class="text-xs px-2 py-1 rounded-full ${
                            goal.frequency === 'daily' ? 'bg-blue-100 text-blue-700' : 
                            goal.frequency === 'weekly' ? 'bg-purple-100 text-purple-700' : 
                            'bg-indigo-100 text-indigo-700'
                        }">
                            <i class="fas ${
                                goal.frequency === 'daily' ? 'fa-calendar-day' : 
                                goal.frequency === 'weekly' ? 'fa-calendar-week' : 
                                'fa-calendar'
                            } mr-1"></i>
                            ${frequencyText[goal.frequency]}
                        </span>
                    </div>
                    <div id="chain-${goal.id}" class="grid ${
                        goal.frequency === 'daily' ? 'grid-cols-7' : 
                        goal.frequency === 'weekly' ? 'grid-cols-8' : 
                        'grid-cols-6'
                    } gap-2 mb-2">
                        <!-- Chain days will be rendered here -->
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-500 mt-2">
                        <div class="flex gap-3">
                            <span><span class="inline-block w-3 h-3 bg-success rounded mr-1"></span>Tamamlandƒ±</span>
                            <span><span class="inline-block w-3 h-3 bg-danger/30 rounded mr-1"></span>Atlandƒ±</span>
                            <span><span class="inline-block w-3 h-3 bg-warning rounded mr-1"></span>${
                                goal.frequency === 'daily' ? 'Bug√ºn' : 
                                goal.frequency === 'weekly' ? 'Bu Hafta' : 
                                'Bu Ay'
                            }</span>
                        </div>
                        <button onclick="toggleChainView(${goal.id})" class="text-primary hover:underline font-medium">
                            <i class="fas fa-calendar-alt mr-1"></i>Takvimi G√∂r√ºnt√ºle
                        </button>
                    </div>
                </div>
            `;
            
            // Render chain days
            setTimeout(() => renderChainDays(goal), 0);
            
            return card;
        }

        // Render chain days for a goal
        function renderChainDays(goal) {
            const chainContainer = document.getElementById(`chain-${goal.id}`);
            if (!chainContainer) return;
            
            chainContainer.innerHTML = '';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // For different frequencies, show different views
            if (goal.frequency === 'weekly') {
                renderWeeklyChainView(goal, chainContainer, today);
            } else if (goal.frequency === 'monthly') {
                renderMonthlyChainView(goal, chainContainer, today);
            } else {
                renderDailyChainView(goal, chainContainer, today);
            }
        }

        // Render daily chain view
        function renderDailyChainView(goal, container, today) {
            // Show last 28 days (4 weeks) for better mobile view
            const daysToShow = 28;
            const startDisplayDate = new Date(today);
            startDisplayDate.setDate(today.getDate() - daysToShow + 1);
            
            // Don't show days before goal start
            const goalStartDate = new Date(goal.startDate);
            if (startDisplayDate < goalStartDate) {
                startDisplayDate.setTime(goalStartDate.getTime());
            }
            
            for (let i = 0; i < daysToShow; i++) {
                const currentDate = new Date(startDisplayDate);
                currentDate.setDate(startDisplayDate.getDate() + i);
                
                if (currentDate > today) break;
                
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayDiv = document.createElement('div');
                
                const isCompleted = goal.completions.includes(dateStr);
                const isToday = currentDate.getTime() === today.getTime();
                const isFuture = currentDate > today;
                const shouldBeCompleted = shouldDayBeCompleted(goal, currentDate);
                const isMissed = !isCompleted && shouldBeCompleted && currentDate < today;
                
                let className = 'chain-day ';
                if (isFuture) {
                    className += 'future';
                } else if (isToday) {
                    className += isCompleted ? 'completed today-completed' : 'today';
                } else if (isCompleted) {
                    className += 'completed';
                } else if (isMissed) {
                    className += 'missed';
                } else {
                    className += 'future';
                }
                
                dayDiv.className = className;
                dayDiv.textContent = currentDate.getDate();
                dayDiv.onclick = () => toggleGoalCompletion(goal.id, dateStr);
                dayDiv.title = `${formatDate(dateStr)} - ${isCompleted ? 'Tamamlandƒ± ‚úì' : isMissed ? 'Atlandƒ± ‚úó' : 'Tamamlanmadƒ±'}`;
                
                container.appendChild(dayDiv);
            }
        }

        // Render weekly chain view - show weeks instead of days
        function renderWeeklyChainView(goal, container, today) {
            const weeksToShow = 8;
            const goalStartDate = new Date(goal.startDate);
            goalStartDate.setHours(0, 0, 0, 0);
            
            const currentWeekStart = getWeekStart(today);
            let displayWeekStart = new Date(currentWeekStart);
            displayWeekStart.setDate(currentWeekStart.getDate() - (weeksToShow - 1) * 7);
            
            // Don't show weeks before goal start
            const goalWeekStart = getWeekStart(goalStartDate);
            if (displayWeekStart < goalWeekStart) {
                displayWeekStart = new Date(goalWeekStart);
            }
            
            for (let i = 0; i < weeksToShow; i++) {
                const weekStart = new Date(displayWeekStart);
                weekStart.setDate(displayWeekStart.getDate() + i * 7);
                
                if (weekStart > currentWeekStart) break;
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const weekDiv = document.createElement('div');
                
                // Check if week has any completion
                const hasCompletion = goal.completions.some(dateStr => {
                    const compDate = new Date(dateStr);
                    return compDate >= weekStart && compDate <= weekEnd;
                });
                
                const isCurrentWeek = weekStart.getTime() === currentWeekStart.getTime();
                const isPastWeek = weekEnd < today;
                const isMissed = isPastWeek && !hasCompletion && weekStart >= goalStartDate;
                
                let className = 'chain-day ';
                if (isCurrentWeek) {
                    className += hasCompletion ? 'completed today-completed' : 'today';
                } else if (hasCompletion) {
                    className += 'completed';
                } else if (isMissed) {
                    className += 'missed';
                } else {
                    className += 'future';
                }
                
                weekDiv.className = className;
                
                // Show week number or first day
                const weekNum = getWeekNumber(weekStart);
                weekDiv.innerHTML = `<div class="text-xs">${weekNum}</div>`;
                
                // Click handler - mark today for this week
                weekDiv.onclick = () => {
                    const dateToMark = isCurrentWeek ? today.toISOString().split('T')[0] : 
                                      (weekEnd < today ? weekEnd : weekStart).toISOString().split('T')[0];
                    toggleGoalCompletion(goal.id, dateToMark);
                };
                
                weekDiv.title = `Hafta ${weekNum} (${formatDate(weekStart.toISOString().split('T')[0])} - ${formatDate(weekEnd.toISOString().split('T')[0])})${hasCompletion ? ' - Tamamlandƒ± ‚úì' : isMissed ? ' - Atlandƒ± ‚úó' : ''}`;
                
                container.appendChild(weekDiv);
            }
        }

        // Render monthly chain view - show months
        function renderMonthlyChainView(goal, container, today) {
            const monthsToShow = 6;
            const goalStartDate = new Date(goal.startDate);
            goalStartDate.setHours(0, 0, 0, 0);
            
            const currentMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            let displayMonth = new Date(currentMonth);
            displayMonth.setMonth(currentMonth.getMonth() - (monthsToShow - 1));
            
            // Don't show months before goal start
            const goalMonthStart = new Date(goalStartDate.getFullYear(), goalStartDate.getMonth(), 1);
            if (displayMonth < goalMonthStart) {
                displayMonth = new Date(goalMonthStart);
            }
            
            for (let i = 0; i < monthsToShow; i++) {
                const monthStart = new Date(displayMonth);
                monthStart.setMonth(displayMonth.getMonth() + i);
                
                if (monthStart > currentMonth) break;
                
                const monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 0);
                
                const monthDiv = document.createElement('div');
                
                // Check if month has any completion
                const hasCompletion = goal.completions.some(dateStr => {
                    const compDate = new Date(dateStr);
                    return compDate >= monthStart && compDate <= monthEnd;
                });
                
                const isCurrentMonth = monthStart.getTime() === currentMonth.getTime();
                const isPastMonth = monthEnd < today;
                const isMissed = isPastMonth && !hasCompletion && monthStart >= goalMonthStart;
                
                let className = 'chain-day ';
                if (isCurrentMonth) {
                    className += hasCompletion ? 'completed today-completed' : 'today';
                } else if (hasCompletion) {
                    className += 'completed';
                } else if (isMissed) {
                    className += 'missed';
                } else {
                    className += 'future';
                }
                
                monthDiv.className = className;
                
                // Show month abbreviation
                const monthNames = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];
                monthDiv.innerHTML = `<div class="text-xs">${monthNames[monthStart.getMonth()]}</div>`;
                
                // Click handler - mark today for this month
                monthDiv.onclick = () => {
                    const dateToMark = isCurrentMonth ? today.toISOString().split('T')[0] : 
                                      (monthEnd < today ? monthEnd : monthStart).toISOString().split('T')[0];
                    toggleGoalCompletion(goal.id, dateToMark);
                };
                
                monthDiv.title = `${monthNames[monthStart.getMonth()]} ${monthStart.getFullYear()}${hasCompletion ? ' - Tamamlandƒ± ‚úì' : isMissed ? ' - Atlandƒ± ‚úó' : ''}`;
                
                container.appendChild(monthDiv);
            }
        }

        // Get week number
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        // Check if a day should be completed based on frequency
        function shouldDayBeCompleted(goal, date) {
            const goalStart = new Date(goal.startDate);
            goalStart.setHours(0, 0, 0, 0);
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (date < goalStart || date > today) return false;
            
            // For daily goals, every day should be completed
            if (goal.frequency === 'daily') {
                return true;
            }
            
            // For weekly goals, check if the week is missed
            if (goal.frequency === 'weekly') {
                const weekStart = getWeekStart(date);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                // If the week has ended and no completion in that week, mark all days in the week as missed
                if (weekEnd < today) {
                    const hasCompletionInWeek = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= weekStart && compDate <= weekEnd;
                    });
                    return !hasCompletionInWeek;
                }
                return false;
            }
            
            // For monthly goals, check if the month is missed
            if (goal.frequency === 'monthly') {
                const monthStart = new Date(date.getFullYear(), date.getMonth(), 1);
                const monthEnd = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                
                // If the month has ended and no completion in that month, mark all days in the month as missed
                if (monthEnd < today) {
                    const hasCompletionInMonth = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= monthStart && compDate <= monthEnd;
                    });
                    return !hasCompletionInMonth;
                }
                return false;
            }
            
            return false;
        }

        // Get week start (Monday)
        function getWeekStart(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is Sunday
            return new Date(d.setDate(diff));
        }

        // Calculate completion rate
        function calculateCompletionRate(goal) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const startDate = new Date(goal.startDate);
            startDate.setHours(0, 0, 0, 0);
            
            const endDate = new Date(goal.endDate);
            endDate.setHours(0, 0, 0, 0);
            
            const relevantEndDate = today < endDate ? today : endDate;
            
            if (relevantEndDate < startDate) return 0;
            
            let expectedCompletions = 0;
            let actualCompletions = 0;
            
            if (goal.frequency === 'daily') {
                const daysPassed = Math.floor((relevantEndDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                expectedCompletions = daysPassed;
                actualCompletions = goal.completions.filter(dateStr => {
                    const compDate = new Date(dateStr);
                    return compDate >= startDate && compDate <= relevantEndDate;
                }).length;
            } else if (goal.frequency === 'weekly') {
                // Count completed weeks vs total weeks
                let currentWeekStart = getWeekStart(startDate);
                const lastWeekStart = getWeekStart(relevantEndDate);
                
                while (currentWeekStart <= lastWeekStart) {
                    expectedCompletions++;
                    
                    const weekEnd = new Date(currentWeekStart);
                    weekEnd.setDate(currentWeekStart.getDate() + 6);
                    
                    const hasCompletion = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= currentWeekStart && compDate <= weekEnd && compDate >= startDate;
                    });
                    
                    if (hasCompletion) actualCompletions++;
                    
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }
            } else if (goal.frequency === 'monthly') {
                // Count completed months vs total months
                let currentMonth = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
                const lastMonth = new Date(relevantEndDate.getFullYear(), relevantEndDate.getMonth(), 1);
                
                while (currentMonth <= lastMonth) {
                    expectedCompletions++;
                    
                    const monthEnd = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
                    
                    const hasCompletion = goal.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= currentMonth && compDate <= monthEnd && compDate >= startDate;
                    });
                    
                    if (hasCompletion) actualCompletions++;
                    
                    currentMonth.setMonth(currentMonth.getMonth() + 1);
                }
            }
            
            if (expectedCompletions === 0) return 0;
            
            return Math.min(100, Math.round((actualCompletions / expectedCompletions) * 100));
        }

        // Update goals stats
        function updateGoalsStats() {
            const goals = storage.getGoals();
            
            const activeGoals = goals.filter(g => isGoalActive(g));
            const longestStreak = Math.max(0, ...goals.map(g => getLongestStreak(g)));
            const totalCompleted = goals.reduce((sum, g) => sum + (g.completions ? g.completions.length : 0), 0);
            
            document.getElementById('activeGoalsCount').textContent = activeGoals.length;
            document.getElementById('longestStreakCount').textContent = longestStreak;
            document.getElementById('totalCompletedCount').textContent = totalCompleted;
        }

        // Update motivation message
        function updateMotivationMessage() {
            const goals = storage.getGoals();
            const motivationDiv = document.getElementById('motivationMessage');
            const titleEl = document.getElementById('motivationTitle');
            const textEl = document.getElementById('motivationText');
            
            if (goals.length === 0) {
                motivationDiv.classList.add('hidden');
                return;
            }
            
            const activeGoals = goals.filter(g => isGoalActive(g));
            
            if (activeGoals.length === 0) {
                motivationDiv.classList.add('hidden');
                return;
            }
            
            // Find best streak
            const bestStreak = Math.max(...activeGoals.map(g => getCurrentStreak(g)));
            
            // Check if any goal needs completion today/this period
            const today = new Date().toISOString().split('T')[0];
            const needsCompletionToday = activeGoals.some(g => {
                if (g.frequency === 'daily') {
                    return !g.completions.includes(today);
                } else if (g.frequency === 'weekly') {
                    const weekStart = getWeekStart(new Date());
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);
                    return !g.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= weekStart && compDate <= weekEnd;
                    });
                } else if (g.frequency === 'monthly') {
                    const now = new Date();
                    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                    const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                    return !g.completions.some(dateStr => {
                        const compDate = new Date(dateStr);
                        return compDate >= monthStart && compDate <= monthEnd;
                    });
                }
                return false;
            });
            
            let title = '';
            let text = '';
            
            // Find the goal with best streak to get its frequency
            const bestStreakGoal = activeGoals.find(g => getCurrentStreak(g) === bestStreak) || activeGoals[0];
            const streakUnit = bestStreakGoal ? (
                bestStreakGoal.frequency === 'daily' ? 'g√ºnl√ºk' : 
                bestStreakGoal.frequency === 'weekly' ? 'haftalƒ±k' : 'aylƒ±k'
            ) : 'g√ºnl√ºk';
            
            if (bestStreak >= 21) {
                title = 'ƒ∞nanƒ±lmaz! üåü';
                text = `${bestStreak} ${streakUnit} serinle efsane oluyorsun! Vazge√ßme!`;
            } else if (bestStreak >= 14) {
                title = 'M√ºkemmel gidiyorsun! üéØ';
                text = `${bestStreak} ${streakUnit} serin var! Harika bir performans!`;
            } else if (bestStreak >= 7) {
                const periodText = streakUnit === 'haftalƒ±k' ? 'ay' : streakUnit === 'aylƒ±k' ? 'd√∂nem' : 'hafta';
                title = `Harika! Bir ${periodText} geride kaldƒ±! ‚ú®`;
                text = `${bestStreak} ${streakUnit} serin var. Devam et!`;
            } else if (bestStreak >= 3) {
                title = 'G√ºzel ba≈ülangƒ±√ß! üî•';
                text = `${bestStreak} ${streakUnit} serin var. Zinciri kƒ±rmayalƒ±m!`;
            } else if (needsCompletionToday) {
                title = 'Hedeflerini tamamladƒ±n mƒ±? ‚è∞';
                text = 'Zincirini kƒ±rmamak i√ßin g√∂revlerini yapmayƒ± unutma!';
            } else {
                title = 'Ba≈ülayalƒ±m! üí™';
                text = 'Her g√ºn biraz daha ilerle, alƒ±≈ükanlƒ±k olu≈ütur!';
            }
            
            titleEl.textContent = title;
            textEl.textContent = text;
            motivationDiv.classList.remove('hidden');
        }

        // Toggle expanded chain view - show full calendar
        let currentCalendarGoal = null;
        let currentCalendarDate = new Date();

        function toggleChainView(goalId) {
            const goals = storage.getGoals();
            const goal = goals.find(g => g.id === goalId);
            
            if (!goal) return;
            
            currentCalendarGoal = goal;
            currentCalendarDate = new Date();
            
            openFullCalendarModal();
        }

        // Open full calendar modal
        function openFullCalendarModal() {
            if (!currentCalendarGoal) return;
            
            const modal = document.getElementById('fullCalendarModal');
            modal.classList.remove('hidden');
            
            renderFullCalendar();
        }

        // Close full calendar modal
        function closeFullCalendarModal() {
            document.getElementById('fullCalendarModal').classList.add('hidden');
            currentCalendarGoal = null;
        }

        // Render full calendar
        function renderFullCalendar() {
            if (!currentCalendarGoal) return;
            
            const goal = currentCalendarGoal;
            const monthYear = document.getElementById('calendarMonthYear');
            const goalTitle = document.getElementById('calendarGoalTitle');
            const frequencyEl = document.getElementById('calendarGoalFrequency');
            const daysGrid = document.getElementById('calendarDaysGrid');
            
            // Set title
            goalTitle.textContent = goal.name;
            
            const frequencyText = {
                'daily': 'G√ºnl√ºk Hedef',
                'weekly': 'Haftalƒ±k Hedef',
                'monthly': 'Aylƒ±k Hedef'
            };
            frequencyEl.textContent = frequencyText[goal.frequency];
            
            // Set month/year
            const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 
                           'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            monthYear.textContent = `${months[currentCalendarDate.getMonth()]} ${currentCalendarDate.getFullYear()}`;
            
            // Update period stats for weekly/monthly goals
            if (goal.frequency !== 'daily') {
                updatePeriodStats(goal);
            }
            
            // Render calendar days
            daysGrid.innerHTML = '';
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // First day of month (0 = Sunday, 1 = Monday, etc.)
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Adjust for Monday start (0 = Monday, 6 = Sunday)
            let startPadding = firstDay.getDay() - 1;
            if (startPadding < 0) startPadding = 6;
            
            // Add padding for days before month starts
            for (let i = 0; i < startPadding; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'aspect-square';
                daysGrid.appendChild(emptyDiv);
            }
            
            // Add actual days
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const goalStart = new Date(goal.startDate);
            goalStart.setHours(0, 0, 0, 0);
            
            const goalEnd = new Date(goal.endDate);
            goalEnd.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const currentDate = new Date(year, month, day);
                currentDate.setHours(0, 0, 0, 0);
                
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayDiv = document.createElement('div');
                
                const isCompleted = goal.completions.includes(dateStr);
                const isToday = currentDate.getTime() === today.getTime();
                const isFuture = currentDate > today;
                const isBeforeStart = currentDate < goalStart;
                const isAfterEnd = currentDate > goalEnd;
                const isInGoalPeriod = currentDate >= goalStart && currentDate <= goalEnd;
                
                let className = 'aspect-square rounded-lg flex items-center justify-center font-semibold cursor-pointer transition-all hover:scale-105 ';
                
                if (isBeforeStart || isAfterEnd) {
                    className += 'bg-gray-100 text-gray-300 cursor-not-allowed';
                    dayDiv.onclick = null;
                } else if (isFuture) {
                    className += 'bg-gray-100 text-gray-400 cursor-not-allowed';
                    dayDiv.onclick = null;
                } else if (isToday) {
                    className += isCompleted 
                        ? 'bg-gradient-to-br from-success to-green-600 text-white shadow-lg ring-4 ring-warning/30' 
                        : 'bg-gradient-to-br from-warning to-orange-600 text-white shadow-lg ring-4 ring-warning/30';
                    dayDiv.onclick = () => toggleGoalCompletion(goal.id, dateStr);
                } else if (isCompleted) {
                    className += 'bg-gradient-to-br from-success to-green-600 text-white shadow-md';
                    dayDiv.onclick = () => toggleGoalCompletion(goal.id, dateStr);
                } else {
                    // Check if should be completed based on frequency
                    const shouldBeCompleted = shouldDayBeCompleted(goal, currentDate);
                    className += shouldBeCompleted 
                        ? 'bg-red-100 text-red-600 border-2 border-red-200' 
                        : 'bg-gray-50 text-gray-600 hover:bg-gray-100';
                    dayDiv.onclick = () => toggleGoalCompletion(goal.id, dateStr);
                }
                
                dayDiv.className = className;
                dayDiv.textContent = day;
                
                // Add tooltip
                const tooltipText = isCompleted ? 'Tamamlandƒ± ‚úì' : 
                                   isFuture ? 'Gelecek tarih' :
                                   isBeforeStart ? 'Hedef ba≈ülangƒ±cƒ±ndan √∂nce' :
                                   isAfterEnd ? 'Hedef biti≈üinden sonra' :
                                   'Tƒ±klayarak i≈üaretle';
                dayDiv.title = `${day} ${months[month]} - ${tooltipText}`;
                
                daysGrid.appendChild(dayDiv);
            }
        }

        // Update period stats for weekly/monthly goals
        function updatePeriodStats(goal) {
            const statsDiv = document.getElementById('periodStats');
            
            if (goal.frequency === 'daily') {
                statsDiv.classList.add('hidden');
                return;
            }
            
            statsDiv.classList.remove('hidden');
            
            const currentStreak = getCurrentStreak(goal);
            const completedPeriods = getCompletedPeriodsCount(goal);
            const totalPeriods = getTotalPeriodsCount(goal);
            
            document.getElementById('periodCurrentStreak').textContent = currentStreak;
            document.getElementById('periodCompletedCount').textContent = completedPeriods;
            document.getElementById('periodTotalPeriods').textContent = totalPeriods;
        }

        // Get completed periods count
        function getCompletedPeriodsCount(goal) {
            if (!goal.completions || goal.completions.length === 0) return 0;
            
            const start = new Date(goal.startDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const end = new Date(goal.endDate);
            const relevantEnd = today < end ? today : end;
            
            if (goal.frequency === 'weekly') {
                let count = 0;
                let currentWeekStart = new Date(start);
                currentWeekStart.setDate(start.getDate() - start.getDay() + 1); // Monday
                
                while (currentWeekStart <= relevantEnd) {
                    const weekEnd = new Date(currentWeekStart);
                    weekEnd.setDate(currentWeekStart.getDate() + 6);
                    
                    const hasCompletion = goal.completions.some(dateStr => {
                        const date = new Date(dateStr);
                        return date >= currentWeekStart && date <= weekEnd && date >= start;
                    });
                    
                    if (hasCompletion) count++;
                    currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                }
                
                return count;
            } else if (goal.frequency === 'monthly') {
                let count = 0;
                let currentMonth = new Date(start.getFullYear(), start.getMonth(), 1);
                
                while (currentMonth <= relevantEnd) {
                    const monthEnd = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
                    
                    const hasCompletion = goal.completions.some(dateStr => {
                        const date = new Date(dateStr);
                        return date >= currentMonth && date <= monthEnd && date >= start;
                    });
                    
                    if (hasCompletion) count++;
                    currentMonth.setMonth(currentMonth.getMonth() + 1);
                }
                
                return count;
            }
            
            return 0;
        }

        // Get total periods count
        function getTotalPeriodsCount(goal) {
            const start = new Date(goal.startDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const end = new Date(goal.endDate);
            const relevantEnd = today < end ? today : end;
            
            if (goal.frequency === 'weekly') {
                const weeks = Math.ceil((relevantEnd - start) / (1000 * 60 * 60 * 24 * 7));
                return Math.max(1, weeks);
            } else if (goal.frequency === 'monthly') {
                const months = (relevantEnd.getFullYear() - start.getFullYear()) * 12 
                    + (relevantEnd.getMonth() - start.getMonth()) + 1;
                return Math.max(1, months);
            }
            
            return 0;
        }

        // Calendar navigation event listeners
        document.getElementById('closeCalendarModal')?.addEventListener('click', closeFullCalendarModal);
        
        document.getElementById('prevCalendarMonth')?.addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderFullCalendar();
        });
        
        document.getElementById('nextCalendarMonth')?.addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderFullCalendar();
        });

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>