<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kilo Takip Uygulaması</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4f46e5',
                        secondary: '#6366f1',
                        accent: '#818cf8',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        dark: '#1e293b',
                        light: '#f8fafc',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .chart-container { position: relative; height: 300px; }
        .measurement-tooltip {
            position: absolute;
            background: #1e293b;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.5;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: none;
            pointer-events: none;
        }
        .measurement-tooltip.active {
            display: block;
        }
        .measurement-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid #1e293b;
        }
        .info-icon {
            cursor: pointer;
            transition: all 0.2s;
        }
        .info-icon:hover {
            transform: scale(1.1);
            color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 p-2 rounded-full">
                        <i class="fas fa-weight text-xl"></i>
                    </div>
                    <h1 class="text-xl md:text-2xl font-bold">Kilo Takip</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-2">
                    <button id="weightSectionBtn" class="section-nav-btn bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-all text-sm font-medium">
                        <i class="fas fa-weight mr-2"></i>Kilo
                    </button>
                    <button id="measurementsSectionBtn" class="section-nav-btn hover:bg-white/20 px-4 py-2 rounded-lg transition-all text-sm font-medium">
                        <i class="fas fa-ruler mr-2"></i>Ölçüler
                    </button>
                </nav>
                <div class="flex items-center space-x-2">
                    <button id="userSettingsBtn" class="bg-white/20 hover:bg-white/30 px-3 py-1 rounded-full transition-all">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Section Navigation -->
    <div id="mobileSectionNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2">
        <div class="grid grid-cols-2 gap-2">
            <button id="mobileWeightSectionBtn" class="mobile-section-nav-btn bg-primary/10 text-primary flex items-center justify-center p-3 rounded-lg font-medium transition-all">
                <i class="fas fa-weight mr-2"></i>Kilo Takibi
            </button>
            <button id="mobileMeasurementsSectionBtn" class="mobile-section-nav-btn text-gray-500 hover:text-primary hover:bg-primary/5 flex items-center justify-center p-3 rounded-lg font-medium transition-all">
                <i class="fas fa-ruler mr-2"></i>Vücut Ölçüleri
            </button>
        </div>
    </div>

    <!-- Mobile Navigation for Weight -->
    <div id="mobileNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2">
        <div class="grid grid-cols-4 gap-1">
            <button onclick="openTab(event, 'weightTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-plus-circle text-xl mb-1"></i>
                <span class="text-xs">Ekle</span>
            </button>
            <button onclick="openTab(event, 'historyTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-history text-xl mb-1"></i>
                <span class="text-xs">Geçmiş</span>
            </button>
            <button onclick="openTab(event, 'targetsTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-bullseye text-xl mb-1"></i>
                <span class="text-xs">Hedefler</span>
            </button>
            <button onclick="openTab(event, 'chartTab')" class="tab-btn mobile-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-chart-line text-xl mb-1"></i>
                <span class="text-xs">Grafik</span>
            </button>
        </div>
    </div>

    <!-- Mobile Navigation for Measurements -->
    <div id="mobileMeasurementNav" class="md:hidden bg-white rounded-xl shadow-soft mx-4 mt-4 p-2 hidden">
        <div class="grid grid-cols-3 gap-1">
            <button onclick="openMeasurementTab(event, 'measurementEntryTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-plus-circle text-xl mb-1"></i>
                <span class="text-xs">Ekle</span>
            </button>
            <button onclick="openMeasurementTab(event, 'measurementHistoryTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-history text-xl mb-1"></i>
                <span class="text-xs">Geçmiş</span>
            </button>
            <button onclick="openMeasurementTab(event, 'measurementChartTab')" class="measurement-tab-btn mobile-measurement-tab-btn flex flex-col items-center justify-center p-3 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/5 transition-all">
                <i class="fas fa-chart-line text-xl mb-1"></i>
                <span class="text-xs">Grafik</span>
            </button>
        </div>
    </div>

    <!-- User Settings Modal -->
    <div id="userSettingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-start md:items-center justify-center z-50 hidden overflow-y-auto py-4">
        <div class="bg-white rounded-xl shadow-medium w-full max-w-md mx-4 p-6 transform transition-all my-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-dark">Kullanıcı Ayarları</h2>
                <button id="closeSettingsModal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-2">Kullanıcı Bilgileri</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm text-gray-600 mb-1">Kullanıcı ID</p>
                    <p id="userDisplay" class="font-mono text-sm text-dark break-all"></p>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-3">Kişisel Bilgiler</h3>
                <p class="text-gray-600 text-sm mb-4">Vücut yağ oranı hesaplaması için boy ve cinsiyet bilgilerinizi girin.</p>
                <form id="profileForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Boy (cm)</label>
                        <input type="number" id="userHeight" step="0.1" min="0" placeholder="Örn: 175" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cinsiyet</label>
                        <select id="userGender" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Seçiniz</option>
                            <option value="male">Erkek</option>
                            <option value="female">Kadın</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-dark mb-3">Veri Yönetimi</h3>
                <p class="text-gray-600 text-sm mb-4">Verileriniz tarayıcınızda saklanır. Farklı cihazlarda kullanmak için verilerinizi dışa aktarabilirsiniz.</p>
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="exportData" class="flex-1 bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition-all">
                        <i class="fas fa-download mr-2"></i> Dışa Aktar
                    </button>
                    <button id="importData" class="flex-1 bg-secondary text-white px-4 py-2 rounded-lg hover:bg-primary transition-all">
                        <i class="fas fa-upload mr-2"></i> İçe Aktar
                    </button>
                </div>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
            
            <div class="border-t pt-4">
                <button id="clearAllData" class="w-full bg-danger text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all">
                    <i class="fas fa-trash-alt mr-2"></i> Tüm Verileri Sil
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Weight Tracking Section -->
        <div id="weightSection" class="section-content">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Mevcut Kilo</p>
                        <p id="currentWeight" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-primary/10 p-3 rounded-full">
                        <i class="fas fa-weight text-primary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Başlangıç Kilo</p>
                        <p id="startingWeight" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-secondary/10 p-3 rounded-full">
                        <i class="fas fa-flag text-secondary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Toplam Değişim</p>
                        <p id="totalChange" class="text-3xl font-bold mt-1">--</p>
                    </div>
                    <div class="bg-warning/10 p-3 rounded-full">
                        <i class="fas fa-chart-line text-warning text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Tabs -->
        <div class="hidden md:flex bg-white rounded-xl shadow-soft p-1 mb-6">
            <button onclick="openTab(event, 'weightTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-plus-circle mr-2"></i> Kilo Girişi
            </button>
            <button onclick="openTab(event, 'historyTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-history mr-2"></i> Geçmiş
            </button>
            <button onclick="openTab(event, 'targetsTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-bullseye mr-2"></i> Hedefler
            </button>
            <button onclick="openTab(event, 'chartTab')" class="tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-chart-line mr-2"></i> Grafikler
            </button>
        </div>

        <!-- Tab Contents -->
        <div id="weightTab" class="tab-content">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-primary mr-3"></i>
                    Yeni Kilo Girişi
                </h2>
                <form id="weightForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tarih</label>
                            <div class="relative">
                                <input type="date" id="date" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Saat</label>
                            <div class="relative">
                                <input type="time" id="time" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-clock absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kilo (kg)</label>
                        <div class="relative">
                            <input type="number" id="weight" step="0.1" min="0" placeholder="Örn: 75.5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                            <i class="fas fa-weight absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Not (İsteğe Bağlı)</label>
                        <div class="relative">
                            <input type="text" id="note" placeholder="Örn: Sabah aç karnına" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
        </div>

        <div id="historyTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-history text-primary mr-3"></i>
                        Kilo Geçmişi
                    </h2>
                    <button id="clearHistory" class="text-danger hover:bg-danger/10 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-trash-alt mr-2"></i> Tümünü Sil
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kilo</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Değişim</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Not</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody" class="bg-white divide-y divide-gray-100">
                            <!-- Veriler JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                    <div id="emptyHistory" class="text-center py-12">
                        <i class="fas fa-weight-scale text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Henüz hiç kilo kaydı yok.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="targetsTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-bullseye text-primary mr-3"></i>
                    Yeni Hedef Ekle
                </h2>
                <form id="targetForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Tarihi</label>
                            <div class="relative">
                                <input type="date" id="targetDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hedef Kilo (kg)</label>
                            <div class="relative">
                                <input type="number" id="targetWeight" step="0.1" min="0" placeholder="Örn: 70.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-weight absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Açıklama</label>
                        <div class="relative">
                            <input type="text" id="targetDescription" placeholder="Örn: Yaz tatiline kadar" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-plus mr-2"></i> Hedef Ekle
                    </button>
                </form>
            </div>

            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-bullseye text-primary mr-3"></i>
                        Hedeflerim
                    </h2>
                </div>
                <div id="targetsList" class="divide-y divide-gray-100">
                    <!-- Hedefler JavaScript ile doldurulacak -->
                    <div id="emptyTargets" class="text-center py-12">
                        <i class="fas fa-bullseye text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Henüz hiç hedef belirlemediniz.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="chartTab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-chart-line text-primary mr-3"></i>
                    Kilo Değişim Grafiği
                </h2>
                <div class="chart-container">
                    <canvas id="weightChart"></canvas>
                </div>
            </div>
        </div>
        </div>
        <!-- End Weight Tracking Section -->

        <!-- Body Measurements Section -->
        <div id="measurementsSection" class="section-content hidden">
        <!-- Measurements Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Boyun Ölçüsü</p>
                        <p id="currentNeck" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-primary/10 p-3 rounded-full">
                        <i class="fas fa-ruler text-primary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Bel Ölçüsü</p>
                        <p id="currentWaist" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-secondary/10 p-3 rounded-full">
                        <i class="fas fa-ruler-horizontal text-secondary text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Son Kalça Ölçüsü</p>
                        <p id="currentHip" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-warning/10 p-3 rounded-full">
                        <i class="fas fa-ruler-combined text-warning text-xl"></i>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-soft p-6 transition-all hover:shadow-medium">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Vücut Yağ Oranı</p>
                        <p id="currentBodyFat" class="text-3xl font-bold text-dark mt-1">--</p>
                    </div>
                    <div class="bg-success/10 p-3 rounded-full">
                        <i class="fas fa-percentage text-success text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Tabs -->
        <div class="hidden md:flex bg-white rounded-xl shadow-soft p-1 mb-6">
            <button onclick="openMeasurementTab(event, 'measurementEntryTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-plus-circle mr-2"></i> Ölçü Girişi
            </button>
            <button onclick="openMeasurementTab(event, 'measurementHistoryTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-history mr-2"></i> Geçmiş
            </button>
            <button onclick="openMeasurementTab(event, 'measurementChartTab')" class="measurement-tab-btn flex-1 py-3 px-6 rounded-lg text-center font-medium text-gray-500 hover:text-primary transition-all">
                <i class="fas fa-chart-line mr-2"></i> Grafikler
            </button>
        </div>

        <!-- Tab Contents -->
        <div id="measurementEntryTab" class="measurement-tab-content">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-plus-circle text-primary mr-3"></i>
                    Yeni Vücut Ölçüsü Girişi
                </h2>
                <form id="measurementForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tarih</label>
                            <div class="relative">
                                <input type="date" id="measurementDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-calendar absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Saat</label>
                            <div class="relative">
                                <input type="time" id="measurementTime" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-clock absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Boyun (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="neck-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="neck-tooltip">
                                    Karşıdaki bir noktaya bakar pozisyonunda boynunuzu dik tutun. Gırtlak çıkıntısının (adem elması) alt sınırındaki noktadan mezuranız ile boyun çevresini ölçebilirsiniz.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="neck" step="0.1" min="0" placeholder="Örn: 35.5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Bel (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="waist-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="waist-tooltip">
                                    Ayakta dik pozisyonda, kollarınız yanınızda gevşek şekilde dururken göbeğinizin en geniş yerinden (genellikle göbek hizasından) mezuranızı gevşek tutarak bel çevrenizi ölçün. Mezura yere paralel olmalıdır.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="waist" step="0.1" min="0" placeholder="Örn: 80.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler-horizontal absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                        <div>
                            <div class="relative">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Kalça (cm)
                                    <i class="fas fa-info-circle info-icon text-gray-400 ml-1" data-tooltip="hip-tooltip"></i>
                                </label>
                                <div class="measurement-tooltip" id="hip-tooltip">
                                    Ayakta dik pozisyonda, ayaklarınız bitişik şekilde dururken kalçanızın en geniş noktasından (genellikle kalça kemiklerinin en çıkıntılı olduğu yerden) mezuranızı gevşek tutarak kalça çevrenizi ölçün.
                                </div>
                            </div>
                            <div class="relative">
                                <input type="number" id="hip" step="0.1" min="0" placeholder="Örn: 95.0" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                                <i class="fas fa-ruler-combined absolute right-3 top-3.5 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Not (İsteğe Bağlı)</label>
                        <div class="relative">
                            <input type="text" id="measurementNote" placeholder="Örn: Sabah ölçümü" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <i class="fas fa-sticky-note absolute right-3 top-3.5 text-gray-400"></i>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 px-6 rounded-lg font-medium hover:bg-secondary transition-all transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-save mr-2"></i> Kaydet
                    </button>
                </form>
            </div>
        </div>

        <div id="measurementHistoryTab" class="measurement-tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft overflow-hidden">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-dark flex items-center">
                        <i class="fas fa-history text-primary mr-3"></i>
                        Ölçü Geçmişi
                    </h2>
                    <button id="clearMeasurementHistory" class="text-danger hover:bg-danger/10 px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-trash-alt mr-2"></i> Tümünü Sil
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tarih</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Boyun</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Bel</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kalça</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Yağ %</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Not</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">İşlem</th>
                            </tr>
                        </thead>
                        <tbody id="measurementHistoryTableBody" class="bg-white divide-y divide-gray-100">
                            <!-- Veriler JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                    <div id="emptyMeasurementHistory" class="text-center py-12">
                        <i class="fas fa-ruler text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Henüz hiç ölçü kaydı yok.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="measurementChartTab" class="measurement-tab-content hidden">
            <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                <h2 class="text-xl font-bold text-dark mb-6 flex items-center">
                    <i class="fas fa-chart-line text-primary mr-3"></i>
                    Vücut Ölçüleri Grafiği
                </h2>
                <div class="chart-container">
                    <canvas id="measurementChart"></canvas>
                </div>
            </div>
        </div>
        </div>
        <!-- End Body Measurements Section -->
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 right-5 bg-white rounded-xl shadow-medium p-4 flex items-center space-x-3 transform translate-x-full transition-transform duration-300 z-50">
        <div id="toastIcon" class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fas fa-check text-white"></i>
        </div>
        <div>
            <p id="toastMessage" class="font-medium text-dark"></p>
        </div>
    </div>

    <script>
        // Kullanıcı ID'si oluştur
        const getUserId = () => {
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        };

        // Veri depolama için local storage kullanımı
        const storage = {
            getWeights: () => {
                const userId = getUserId();
                const key = `weights_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveWeights: (weights) => {
                const userId = getUserId();
                const key = `weights_${userId}`;
                localStorage.setItem(key, JSON.stringify(weights));
            },
            getTargets: () => {
                const userId = getUserId();
                const key = `targets_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveTargets: (targets) => {
                const userId = getUserId();
                const key = `targets_${userId}`;
                localStorage.setItem(key, JSON.stringify(targets));
            },
            getMeasurements: () => {
                const userId = getUserId();
                const key = `measurements_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || [];
            },
            saveMeasurements: (measurements) => {
                const userId = getUserId();
                const key = `measurements_${userId}`;
                localStorage.setItem(key, JSON.stringify(measurements));
            },
            getProfile: () => {
                const userId = getUserId();
                const key = `profile_${userId}`;
                return JSON.parse(localStorage.getItem(key)) || { height: null, gender: null };
            },
            saveProfile: (profile) => {
                const userId = getUserId();
                const key = `profile_${userId}`;
                localStorage.setItem(key, JSON.stringify(profile));
            }
        };

        // Sayfa yüklendiğinde çalışacak fonksiyonlar
        document.addEventListener('DOMContentLoaded', () => {
            // Kullanıcı ID'sini göster
            document.getElementById('userDisplay').textContent = getUserId();
            
            // Varsayılan tarih ve saat ayarla
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().substring(0, 5);
            document.getElementById('measurementDate').valueAsDate = now;
            document.getElementById('measurementTime').value = now.toTimeString().substring(0, 5);
            
            // Load profile data
            loadProfileForm();
            
            // Verileri yükle
            updateStats();
            renderHistory();
            renderTargets();
            initChart();
            updateMeasurementStats();
            renderMeasurementHistory();
            initMeasurementChart();
            
            // Form event listeners
            document.getElementById('weightForm').addEventListener('submit', handleWeightSubmit);
            document.getElementById('targetForm').addEventListener('submit', handleTargetSubmit);
            document.getElementById('measurementForm').addEventListener('submit', handleMeasurementSubmit);
            document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
            document.getElementById('clearHistory').addEventListener('click', clearAllHistory);
            document.getElementById('clearMeasurementHistory').addEventListener('click', clearAllMeasurementHistory);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importData);
            document.getElementById('clearAllData').addEventListener('click', clearAllData);
            
            // Measurement tooltips
            const tooltipIcons = document.querySelectorAll('.info-icon');
            let activeTooltip = null;
            
            tooltipIcons.forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const tooltipId = icon.getAttribute('data-tooltip');
                    const tooltip = document.getElementById(tooltipId);
                    
                    // Close active tooltip if different
                    if (activeTooltip && activeTooltip !== tooltip) {
                        activeTooltip.classList.remove('active');
                    }
                    
                    // Toggle current tooltip
                    tooltip.classList.toggle('active');
                    
                    if (tooltip.classList.contains('active')) {
                        activeTooltip = tooltip;
                        // Position tooltip
                        const iconRect = icon.getBoundingClientRect();
                        tooltip.style.top = (iconRect.bottom + 5) + 'px';
                        tooltip.style.left = (iconRect.left - 10) + 'px';
                    } else {
                        activeTooltip = null;
                    }
                });
            });
            
            // Close tooltips when clicking outside
            document.addEventListener('click', (e) => {
                if (activeTooltip && !e.target.classList.contains('info-icon')) {
                    activeTooltip.classList.remove('active');
                    activeTooltip = null;
                }
            });
            
            // User settings modal
            document.getElementById('userSettingsBtn').addEventListener('click', () => {
                document.getElementById('userSettingsModal').classList.remove('hidden');
            });
            
            document.getElementById('closeSettingsModal').addEventListener('click', () => {
                document.getElementById('userSettingsModal').classList.add('hidden');
            });
            
            // Modal dışına tıklayınca kapat
            document.getElementById('userSettingsModal').addEventListener('click', (e) => {
                if (e.target.id === 'userSettingsModal') {
                    document.getElementById('userSettingsModal').classList.add('hidden');
                }
            });
            
            // Section navigation
            document.getElementById('weightSectionBtn')?.addEventListener('click', () => switchSection('weight'));
            document.getElementById('measurementsSectionBtn')?.addEventListener('click', () => switchSection('measurements'));
            document.getElementById('mobileWeightSectionBtn')?.addEventListener('click', () => switchSection('weight'));
            document.getElementById('mobileMeasurementsSectionBtn')?.addEventListener('click', () => switchSection('measurements'));
            
            // Event delegation for delete buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.delete-weight-btn')) {
                    const id = parseInt(e.target.closest('.delete-weight-btn').dataset.id);
                    deleteWeight(id);
                } else if (e.target.closest('.delete-target-btn')) {
                    const id = parseInt(e.target.closest('.delete-target-btn').dataset.id);
                    deleteTarget(id);
                } else if (e.target.closest('.delete-measurement-btn')) {
                    const id = parseInt(e.target.closest('.delete-measurement-btn').dataset.id);
                    deleteMeasurement(id);
                }
            });
            
            // Set active tab
            document.querySelector('.tab-btn')?.classList.add('bg-primary/10', 'text-primary');
            document.querySelector('.measurement-tab-btn')?.classList.add('bg-primary/10', 'text-primary');
        });

        // Tüm verileri sil
        function clearAllData() {
            if (confirm('Tüm verilerinizi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                const userId = getUserId();
                localStorage.removeItem(`weights_${userId}`);
                localStorage.removeItem(`targets_${userId}`);
                localStorage.removeItem(`measurements_${userId}`);
                localStorage.removeItem(`profile_${userId}`);
                
                updateStats();
                renderHistory();
                renderTargets();
                updateChart();
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                loadProfileForm();
                
                showToast('Tüm veriler silindi!', 'info');
                document.getElementById('userSettingsModal').classList.add('hidden');
            }
        }

        // Verileri dışa aktar
        function exportData() {
            const userId = getUserId();
            const data = {
                userId: userId,
                weights: storage.getWeights(),
                targets: storage.getTargets(),
                measurements: storage.getMeasurements(),
                profile: storage.getProfile(),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `kilo-takip-${userId}-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('Veriler başarıyla dışa aktarıldı!', 'success');
        }

        // Verileri içe aktar
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.weights && data.targets) {
                        // Yeni verileri yükle
                        storage.saveWeights(data.weights);
                        storage.saveTargets(data.targets);
                        
                        // Measurements verisi varsa onu da yükle (geriye uyumluluk için kontrol)
                        if (data.measurements) {
                            storage.saveMeasurements(data.measurements);
                        }
                        
                        // Profile verisi varsa onu da yükle
                        if (data.profile) {
                            storage.saveProfile(data.profile);
                        }
                        
                        // Arayüzü güncelle
                        updateStats();
                        renderHistory();
                        renderTargets();
                        updateChart();
                        updateMeasurementStats();
                        renderMeasurementHistory();
                        updateMeasurementChart();
                        loadProfileForm();
                        
                        showToast('Veriler başarıyla içe aktarıldı!', 'success');
                    } else {
                        showToast('Geçersiz dosya formatı!', 'danger');
                    }
                } catch (error) {
                    showToast('Dosya okunurken hata oluştu!', 'danger');
                }
            };
            reader.readAsText(file);
            
            // Dosya inputunu temizle
            event.target.value = '';
        }

        // Sekme değiştirme fonksiyonu
        function openTab(evt, tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            const tabs = document.querySelectorAll('.tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('bg-primary/10', 'text-primary');
                tab.classList.add('text-gray-500');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            evt.currentTarget.classList.add('bg-primary/10', 'text-primary');
            evt.currentTarget.classList.remove('text-gray-500');
            
            if (tabName === 'chartTab') {
                updateChart();
            }
        }

        // Kilo form gönderildiğinde
        function handleWeightSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const weight = parseFloat(document.getElementById('weight').value);
            const note = document.getElementById('note').value;
            
            const dateTime = `${date}T${time}`;
            
            const newWeight = {
                id: Date.now(),
                date: date,
                time: time,
                dateTime: dateTime,
                weight: weight,
                note: note
            };
            
            const weights = storage.getWeights();
            weights.push(newWeight);
            weights.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            storage.saveWeights(weights);
            updateStats();
            renderHistory();
            updateChart();
            
            document.getElementById('weightForm').reset();
            const now = new Date();
            document.getElementById('date').valueAsDate = now;
            document.getElementById('time').value = now.toTimeString().substring(0, 5);
            
            showToast('Kilo kaydı başarıyla eklendi!', 'success');
        }

        // Hedef form gönderildiğinde
        function handleTargetSubmit(e) {
            e.preventDefault();
            
            const targetDate = document.getElementById('targetDate').value;
            const targetWeight = parseFloat(document.getElementById('targetWeight').value);
            const description = document.getElementById('targetDescription').value;
            
            const newTarget = {
                id: Date.now(),
                date: targetDate,
                weight: targetWeight,
                description: description,
                completed: false
            };
            
            const targets = storage.getTargets();
            targets.push(newTarget);
            targets.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            storage.saveTargets(targets);
            renderTargets();
            
            document.getElementById('targetForm').reset();
            
            showToast('Hedef başarıyla eklendi!', 'success');
        }

        // İstatistikleri güncelle
        function updateStats() {
            const weights = storage.getWeights();
            
            if (weights.length === 0) {
                document.getElementById('currentWeight').textContent = '--';
                document.getElementById('startingWeight').textContent = '--';
                document.getElementById('totalChange').textContent = '--';
                return;
            }
            
            const currentWeight = weights[weights.length - 1].weight;
            document.getElementById('currentWeight').textContent = `${currentWeight} kg`;
            
            const startingWeight = weights[0].weight;
            document.getElementById('startingWeight').textContent = `${startingWeight} kg`;
            
            const totalChange = currentWeight - startingWeight;
            const changeElement = document.getElementById('totalChange');
            changeElement.textContent = `${totalChange > 0 ? '+' : ''}${totalChange.toFixed(1)} kg`;
            changeElement.className = totalChange >= 0 ? 'text-3xl font-bold text-danger mt-1' : 'text-3xl font-bold text-success mt-1';
        }

        // Kilo geçmişini render et
        function renderHistory() {
            const weights = storage.getWeights();
            const tableBody = document.getElementById('historyTableBody');
            const emptyState = document.getElementById('emptyHistory');
            
            tableBody.innerHTML = '';
            
            if (weights.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            [...weights].reverse().forEach((weight, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                let changeHtml = '<span class="text-gray-400">--</span>';
                if (index < weights.length - 1) {
                    const prevWeight = weights[weights.length - 1 - index - 1].weight;
                    const change = weight.weight - prevWeight;
                    const changeClass = change > 0 ? 'text-danger' : 'text-success';
                    const changeSymbol = change > 0 ? '+' : '';
                    changeHtml = `<span class="font-medium ${changeClass}">${changeSymbol}${change.toFixed(1)} kg</span>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${formatDate(weight.date)}</div>
                        <div class="text-sm text-gray-500">${weight.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${weight.weight} kg</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${changeHtml}
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${weight.note || '--'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="delete-weight-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all" data-id="${weight.id}">
                            <i class="fas fa-trash-alt"></i> Sil
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Hedefleri render et
        function renderTargets() {
            const targets = storage.getTargets();
            const targetsList = document.getElementById('targetsList');
            const emptyState = document.getElementById('emptyTargets');
            
            targetsList.innerHTML = '';
            
            if (targets.length === 0) {
                targetsList.appendChild(emptyState);
                return;
            }
            
            const weights = storage.getWeights();
            const currentWeight = weights.length > 0 ? weights[weights.length - 1].weight : null;
            
            targets.forEach(target => {
                const targetItem = document.createElement('div');
                targetItem.className = 'p-6';
                
                const today = new Date();
                const targetDate = new Date(target.date);
                const diffTime = targetDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                let progressHtml = '';
                let statusHtml = '';
                
                if (currentWeight !== null) {
                    const startingWeight = weights.length > 0 ? weights[0].weight : currentWeight;
                    const totalChange = currentWeight - startingWeight;
                    const targetChange = target.weight - startingWeight;
                    
                    let progressPercent = 0;
                    if (targetChange !== 0) {
                        progressPercent = Math.min(100, Math.max(0, (totalChange / targetChange) * 100));
                    }
                    
                    progressHtml = `
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-primary h-2.5 rounded-full" style="width: ${progressPercent}%"></div>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">${progressPercent.toFixed(1)}% tamamlandı</div>
                    `;
                    
                    if (diffDays < 0) {
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger/10 text-danger">Tarihi geçti</span>`;
                    } else if (Math.abs(currentWeight - target.weight) < 0.1) {
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success/10 text-success">Hedefe ulaşıldı!</span>`;
                    } else if (currentWeight > target.weight) {
                        const remaining = currentWeight - target.weight;
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger/10 text-danger">Hedefe ${remaining.toFixed(1)} kg kaldı</span>`;
                    } else {
                        const remaining = target.weight - currentWeight;
                        statusHtml = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success/10 text-success">Hedefe ${remaining.toFixed(1)} kg kaldı</span>`;
                    }
                } else {
                    progressHtml = `
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-gray-400 h-2.5 rounded-full" style="width: 0%"></div>
                        </div>
                    `;
                    statusHtml = '<span class="text-gray-500 text-sm">Kilo kaydı yok</span>';
                }
                
                targetItem.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div class="mb-4 md:mb-0 md:flex-1">
                            <div class="flex items-center">
                                <div class="bg-primary/10 p-2 rounded-lg mr-3">
                                    <i class="fas fa-bullseye text-primary"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold">${formatDate(target.date)} - ${target.weight} kg</h3>
                                    <p class="text-gray-600 text-sm">${target.description || 'Açıklama yok'}</p>
                                </div>
                            </div>
                            ${progressHtml}
                        </div>
                        <div class="flex flex-col items-end">
                            <div class="mb-2">${statusHtml}</div>
                            <div class="text-sm text-gray-500 mb-3">${diffDays >= 0 ? `${diffDays} gün kaldı` : 'Süresi doldu'}</div>
                            <button class="delete-target-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all text-sm" data-id="${target.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Sil
                            </button>
                        </div>
                    </div>
                `;
                
                targetsList.appendChild(targetItem);
            });
        }

        // Grafiği başlat
        let weightChart;
        function initChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Kilo (kg)',
                        data: [],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#4f46e5',
                        pointRadius: 5,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    return `Kilo: ${context.parsed.y} kg`;
                                }
                            }
                        }
                    }
                }
            });
            
            updateChart();
        }

        // Grafiği güncelle
        function updateChart() {
            if (!weightChart) return;
            
            const weights = storage.getWeights();
            const targets = storage.getTargets();
            
            const labels = weights.map(w => formatDate(w.date));
            const data = weights.map(w => w.weight);
            
            const datasets = [{
                label: 'Kilo (kg)',
                data: data,
                borderColor: '#4f46e5',
                backgroundColor: 'rgba(79, 70, 229, 0.1)',
                borderWidth: 3,
                pointBackgroundColor: '#4f46e5',
                pointRadius: 5,
                tension: 0.3,
                fill: true
            }];
            
            const colors = ['#10b981', '#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6'];
            
            targets.forEach((target, index) => {
                const targetIndex = labels.findIndex(label => label === formatDate(target.date));
                
                if (targetIndex !== -1) {
                    datasets.push({
                        label: `Hedef ${index + 1}: ${target.weight} kg`,
                        data: Array(targetIndex).fill(null).concat([target.weight]),
                        borderColor: colors[index % colors.length],
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointBackgroundColor: colors[index % colors.length],
                        pointRadius: 6,
                        pointStyle: 'rectRot',
                        fill: false
                    });
                }
                
                datasets.push({
                    label: `Hedef Kilo: ${target.weight} kg`,
                    data: Array(labels.length).fill(target.weight),
                    borderColor: colors[index % colors.length],
                    borderWidth: 2,
                    borderDash: [5, 5],
                    pointRadius: 0,
                    fill: false
                });
            });
            
            weightChart.data.labels = labels;
            weightChart.data.datasets = datasets;
            weightChart.update();
        }

        // Kilo kaydını sil
        function deleteWeight(id) {
            if (confirm('Bu kilo kaydını silmek istediğinizden emin misiniz?')) {
                let weights = storage.getWeights();
                weights = weights.filter(w => w.id !== id);
                storage.saveWeights(weights);
                
                updateStats();
                renderHistory();
                updateChart();
                
                showToast('Kilo kaydı silindi!', 'info');
            }
        }

        // Hedefi sil
        function deleteTarget(id) {
            if (confirm('Bu hedefi silmek istediğinizden emin misiniz?')) {
                let targets = storage.getTargets();
                targets = targets.filter(t => t.id !== id);
                storage.saveTargets(targets);
                
                renderTargets();
                updateChart();
                
                showToast('Hedef silindi!', 'info');
            }
        }

        // Tüm geçmişi sil
        function clearAllHistory() {
            if (confirm('Tüm kilo geçmişini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                storage.saveWeights([]);
                updateStats();
                renderHistory();
                updateChart();
                
                showToast('Tüm kilo geçmişi silindi!', 'info');
            }
        }

        // Tarih formatla
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('tr-TR', options);
        }

        // Toast bildirim göster
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-success';
                toastIcon.innerHTML = '<i class="fas fa-check text-white"></i>';
            } else if (type === 'danger') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-danger';
                toastIcon.innerHTML = '<i class="fas fa-times text-white"></i>';
            } else if (type === 'warning') {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-warning';
                toastIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-white"></i>';
            } else {
                toastIcon.className = 'flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-primary';
                toastIcon.innerHTML = '<i class="fas fa-info text-white"></i>';
            }
            
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 5000);
        }

        // ============= PROFILE FUNCTIONS =============
        
        // Load profile form data
        function loadProfileForm() {
            const profile = storage.getProfile();
            if (profile.height) {
                document.getElementById('userHeight').value = profile.height;
            }
            if (profile.gender) {
                document.getElementById('userGender').value = profile.gender;
            }
        }
        
        // Handle profile form submit
        function handleProfileSubmit(e) {
            e.preventDefault();
            
            const height = parseFloat(document.getElementById('userHeight').value);
            const gender = document.getElementById('userGender').value;
            
            if (!height || !gender) {
                showToast('Lütfen tüm alanları doldurun!', 'danger');
                return;
            }
            
            const profile = {
                height: height,
                gender: gender
            };
            
            storage.saveProfile(profile);
            updateMeasurementStats();
            renderMeasurementHistory();
            
            showToast('Profil bilgileri kaydedildi!', 'success');
        }
        
        // Calculate body fat percentage using U.S. Navy method
        function calculateBodyFat(neck, waist, hip, height, gender) {
            if (!height || !gender || !neck || !waist || !hip) {
                return null;
            }
            
            let bodyFat;
            
            if (gender === 'male') {
                // Men's formula: BF% = 495 / (1.0324 - 0.19077 * log10(waist - neck) + 0.15456 * log10(height)) - 450
                const value = 1.0324 - 0.19077 * Math.log10(waist - neck) + 0.15456 * Math.log10(height);
                bodyFat = 495 / value - 450;
            } else if (gender === 'female') {
                // Women's formula: BF% = 495 / (1.29579 - 0.35004 * log10(waist + hip - neck) + 0.22100 * log10(height)) - 450
                const value = 1.29579 - 0.35004 * Math.log10(waist + hip - neck) + 0.22100 * Math.log10(height);
                bodyFat = 495 / value - 450;
            }
            
            // Ensure result is within reasonable bounds
            if (bodyFat < 0) bodyFat = 0;
            if (bodyFat > 100) bodyFat = 100;
            
            return bodyFat;
        }

        // ============= MEASUREMENTS SECTION FUNCTIONS =============

        // Switch between sections
        function switchSection(section) {
            const weightSection = document.getElementById('weightSection');
            const measurementsSection = document.getElementById('measurementsSection');
            const mobileNav = document.getElementById('mobileNav');
            const mobileMeasurementNav = document.getElementById('mobileMeasurementNav');
            
            // Update section visibility
            if (section === 'weight') {
                weightSection.classList.remove('hidden');
                measurementsSection.classList.add('hidden');
                mobileNav.classList.remove('hidden');
                mobileMeasurementNav.classList.add('hidden');
                
                // Update desktop buttons
                document.getElementById('weightSectionBtn')?.classList.add('bg-white/20');
                document.getElementById('measurementsSectionBtn')?.classList.remove('bg-white/20');
                
                // Update mobile buttons
                document.getElementById('mobileWeightSectionBtn')?.classList.add('bg-primary/10', 'text-primary');
                document.getElementById('mobileWeightSectionBtn')?.classList.remove('text-gray-500');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.remove('bg-primary/10', 'text-primary');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.add('text-gray-500');
            } else {
                weightSection.classList.add('hidden');
                measurementsSection.classList.remove('hidden');
                mobileNav.classList.add('hidden');
                mobileMeasurementNav.classList.remove('hidden');
                
                // Update desktop buttons
                document.getElementById('weightSectionBtn')?.classList.remove('bg-white/20');
                document.getElementById('measurementsSectionBtn')?.classList.add('bg-white/20');
                
                // Update mobile buttons
                document.getElementById('mobileWeightSectionBtn')?.classList.remove('bg-primary/10', 'text-primary');
                document.getElementById('mobileWeightSectionBtn')?.classList.add('text-gray-500');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.add('bg-primary/10', 'text-primary');
                document.getElementById('mobileMeasurementsSectionBtn')?.classList.remove('text-gray-500');
                
                // Update chart when switching to measurements
                updateMeasurementChart();
            }
        }

        // Ölçü sekmesi değiştirme fonksiyonu
        function openMeasurementTab(evt, tabName) {
            const tabContents = document.querySelectorAll('.measurement-tab-content');
            tabContents.forEach(content => {
                content.classList.add('hidden');
            });
            
            const tabs = document.querySelectorAll('.measurement-tab-btn');
            tabs.forEach(tab => {
                tab.classList.remove('bg-primary/10', 'text-primary');
                tab.classList.add('text-gray-500');
            });
            
            document.getElementById(tabName).classList.remove('hidden');
            evt.currentTarget.classList.add('bg-primary/10', 'text-primary');
            evt.currentTarget.classList.remove('text-gray-500');
            
            if (tabName === 'measurementChartTab') {
                updateMeasurementChart();
            }
        }

        // Ölçü form gönderildiğinde
        function handleMeasurementSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('measurementDate').value;
            const time = document.getElementById('measurementTime').value;
            const neckInput = document.getElementById('neck').value;
            const waistInput = document.getElementById('waist').value;
            const hipInput = document.getElementById('hip').value;
            const note = document.getElementById('measurementNote').value;
            
            // Validate all measurements are filled
            if (!neckInput || !waistInput || !hipInput) {
                showToast('Lütfen tüm ölçü alanlarını doldurun!', 'danger');
                return;
            }
            
            const neck = parseFloat(neckInput);
            const waist = parseFloat(waistInput);
            const hip = parseFloat(hipInput);
            
            // Check if profile info is available for body fat calculation
            const profile = storage.getProfile();
            let bodyFat = null;
            let showWarning = false;
            
            if (!profile.height || !profile.gender) {
                showWarning = true;
            } else {
                bodyFat = calculateBodyFat(neck, waist, hip, profile.height, profile.gender);
            }
            
            const dateTime = `${date}T${time}`;
            
            const newMeasurement = {
                id: Date.now(),
                date: date,
                time: time,
                dateTime: dateTime,
                neck: neck,
                waist: waist,
                hip: hip,
                bodyFat: bodyFat,
                note: note
            };
            
            const measurements = storage.getMeasurements();
            measurements.push(newMeasurement);
            measurements.sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));
            
            storage.saveMeasurements(measurements);
            updateMeasurementStats();
            renderMeasurementHistory();
            updateMeasurementChart();
            
            document.getElementById('measurementForm').reset();
            const now = new Date();
            document.getElementById('measurementDate').valueAsDate = now;
            document.getElementById('measurementTime').value = now.toTimeString().substring(0, 5);
            
            if (showWarning) {
                showToast('Ölçü kaydedildi! ⚠️ Vücut yağ oranı hesaplanamadı. Lütfen ayarlardan boy ve cinsiyet bilgilerinizi girin.', 'warning');
            } else {
                showToast('Ölçü kaydı başarıyla eklendi!', 'success');
            }
        }

        // Ölçü istatistiklerini güncelle
        function updateMeasurementStats() {
            const measurements = storage.getMeasurements();
            
            if (measurements.length === 0) {
                document.getElementById('currentNeck').textContent = '--';
                document.getElementById('currentWaist').textContent = '--';
                document.getElementById('currentHip').textContent = '--';
                document.getElementById('currentBodyFat').textContent = '--';
                return;
            }
            
            const latest = measurements[measurements.length - 1];
            const profile = storage.getProfile();
            
            document.getElementById('currentNeck').textContent = `${latest.neck} cm`;
            document.getElementById('currentWaist').textContent = `${latest.waist} cm`;
            document.getElementById('currentHip').textContent = `${latest.hip} cm`;
            
            // Calculate or recalculate body fat if possible
            let bodyFat = latest.bodyFat;
            if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                bodyFat = calculateBodyFat(latest.neck, latest.waist, latest.hip, profile.height, profile.gender);
            }
            
            if (bodyFat !== null && bodyFat !== undefined) {
                document.getElementById('currentBodyFat').textContent = `${bodyFat.toFixed(1)}%`;
            } else {
                document.getElementById('currentBodyFat').textContent = '--';
            }
        }

        // Ölçü geçmişini render et
        function renderMeasurementHistory() {
            const measurements = storage.getMeasurements();
            const tableBody = document.getElementById('measurementHistoryTableBody');
            const emptyState = document.getElementById('emptyMeasurementHistory');
            const profile = storage.getProfile();
            
            tableBody.innerHTML = '';
            
            if (measurements.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            [...measurements].reverse().forEach((measurement) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                // Calculate or recalculate body fat if possible
                let bodyFat = measurement.bodyFat;
                if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                    bodyFat = calculateBodyFat(measurement.neck, measurement.waist, measurement.hip, profile.height, profile.gender);
                }
                
                let bodyFatDisplay = '--';
                if (bodyFat !== null && bodyFat !== undefined) {
                    bodyFatDisplay = `<div class="text-sm font-medium text-success">${bodyFat.toFixed(1)}%</div>`;
                } else {
                    bodyFatDisplay = `<div class="text-sm text-gray-400">N/A</div>`;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${formatDate(measurement.date)}</div>
                        <div class="text-sm text-gray-500">${measurement.time}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.neck} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.waist} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium">${measurement.hip} cm</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        ${bodyFatDisplay}
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm">${measurement.note || '--'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="delete-measurement-btn text-danger hover:bg-danger/10 px-3 py-1 rounded-lg transition-all" data-id="${measurement.id}">
                            <i class="fas fa-trash-alt"></i> Sil
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Ölçü kaydını sil
        function deleteMeasurement(id) {
            if (confirm('Bu ölçü kaydını silmek istediğinizden emin misiniz?')) {
                let measurements = storage.getMeasurements();
                measurements = measurements.filter(m => m.id !== id);
                storage.saveMeasurements(measurements);
                
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                
                showToast('Ölçü kaydı silindi!', 'info');
            }
        }

        // Tüm ölçü geçmişini sil
        function clearAllMeasurementHistory() {
            if (confirm('Tüm ölçü geçmişini silmek istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
                storage.saveMeasurements([]);
                updateMeasurementStats();
                renderMeasurementHistory();
                updateMeasurementChart();
                
                showToast('Tüm ölçü geçmişi silindi!', 'info');
            }
        }

        // Ölçü grafiğini başlat
        let measurementChart;
        function initMeasurementChart() {
            const ctx = document.getElementById('measurementChart').getContext('2d');
            measurementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Boyun (cm)',
                            data: [],
                            borderColor: '#4f46e5',
                            backgroundColor: 'rgba(79, 70, 229, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#4f46e5',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Bel (cm)',
                            data: [],
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#6366f1',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Kalça (cm)',
                            data: [],
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#f59e0b',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Vücut Yağ % ',
                            data: [],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#10b981',
                            pointRadius: 5,
                            tension: 0.3,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: false,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            title: {
                                display: true,
                                text: 'Ölçü (cm)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            grid: { 
                                drawOnChartArea: false
                            },
                            title: {
                                display: true,
                                text: 'Yağ Oranı (%)'
                            }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8
                        }
                    }
                }
            });
            
            updateMeasurementChart();
        }

        // Ölçü grafiğini güncelle
        function updateMeasurementChart() {
            if (!measurementChart) return;
            
            const measurements = storage.getMeasurements();
            const profile = storage.getProfile();
            
            const labels = measurements.map(m => formatDate(m.date));
            const neckData = measurements.map(m => m.neck);
            const waistData = measurements.map(m => m.waist);
            const hipData = measurements.map(m => m.hip);
            
            // Calculate body fat for each measurement
            const bodyFatData = measurements.map(m => {
                let bodyFat = m.bodyFat;
                if ((!bodyFat || bodyFat === null) && profile.height && profile.gender) {
                    bodyFat = calculateBodyFat(m.neck, m.waist, m.hip, profile.height, profile.gender);
                }
                return bodyFat;
            });
            
            measurementChart.data.labels = labels;
            measurementChart.data.datasets[0].data = neckData;
            measurementChart.data.datasets[1].data = waistData;
            measurementChart.data.datasets[2].data = hipData;
            measurementChart.data.datasets[3].data = bodyFatData;
            measurementChart.update();
        }
    </script>
</body>
</html>